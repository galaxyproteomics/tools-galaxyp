<tool id="Pathview" name="KEGG pathway mapping (pathview)" version="0.1.0">
    <requirements>
        <requirement type="package" version="1.18.0">bioconductor-pathview</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript $__tool_directory__/PathView.R 
        #if $input.ids == "text"
            --id_list="$input.txt"
        #else
            --input="$input.file"
            --id_column="$input.ncol"
            --header="$input.header"  
        #end if
        #if $pathways.pathways_id == "pathways_ids"
            --pathways_id="$pathways.pids" 
        #else 
            --pathways_names="$pathways.pnames"
        #end if
        --id_type="$id_type"  
        --native_kegg="$native" 
        --species="$species"
    ]]></command>
    <inputs>
        <conditional name="input" >
            <param name="ids" type="select" label="Provide your identifiers" help="Copy/paste or ID list from a file (e.g. table)" >
                <option value="text">Copy/paste your identifiers</option>
                <option value="file" selected="true">Input file containing your identifiers</option>
            </param>
            <when value="text" >
                <param name="txt" type="text" label="Copy/paste your identifiers" help='IDs must be separated by "," into the form field, for example: P31946,P62258' >
                    <sanitizer>
                        <valid initial="string.printable">
                            <remove value="&apos;"/>
                        </valid>
                        <mapping initial="none">
                            <add source="&apos;" target="__sq__"/>
                        </mapping>
                    </sanitizer>
                </param>
            </when>
            <when value="file" >
                <param name="file" type="data" format="txt,tabular" label="Choose a file that contains your list of IDs" help="" />
                <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file contain header?" />
                <param name="ncol" type="text" value="c1" label="The column number of IDs to map" help='For example, fill in "c1" if it is the first column, "c2" if it is the second column and so on' />
            </when>
        </conditional>
        <param name="id_type" type="select" label="Choose your identifiers :">
            <option value="uniprotID">Uniprot Accession number</option>
            <option value="geneID">Entrez gene ID</option>
        </param>
        <conditional name="pathways">
            <param name="pathways_id" type="select" label="Provide your pathway(s)" help="Enter KEGG pathway id(s) or KEGG pathway name(s)">
                <option value="pathways_ids">KEGG pathway id(s)</option>
                <option value="pathways_names">KEGG pathway name(s)</option>
            </param>
            <when value="pathways_ids">
                <param name="pids" type="text" label="Copy/paste your pathway id(s)" help='IDs must be separated by "," into the form field, for example: 00010,05412'/>
            </when>
            <when value="pathways_names">
                <param name="pnames" type="text" label="Copy/paste your pathway name(s)" help='names must be separated by "," into the form field, for example: Glycolysis /
                        Gluconeogenesis - Homo sapiens (human),Arrhythmogenic
                        right ventricular cardiomyopathy (ARVC) - Homo sapiens
                        (human)'/>
            </when>
        </conditional>
        <param name="species" type="select" label="Choose a species">
            <option value="hsa">Human</option>
        </param >
        <param name="native" type="select" label="Choose the output graph format">
            <option value="true">KEGG graph (.png)</option>
            <option value="false">Graphviz layout engine (.pdf)</option> 
        </param>
    </inputs>
    <outputs>
        <data name="graphviz" format="pdf">
            <filter>native=="false"</filter>
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.pathview\.pdf" ext="pdf" visible="true" recurse="true" />
        </data>
        <data name="kegg" format="png">
            <filter>native=="true"</filter>
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.pathview\.png" ext="png" visible="true" recurse="true"/>
        </data>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="ids" value="file"/>
                <param name="file" value="Lacombe_et_al_2017_OK.txt"/>
                <param name="header" value="true"/>
                <param name="ncol" value="c1"/>
            </conditional>
            <conditional name="pathways">
                <param name="pathways_id" value="pathways_ids"/>
                <param name="pids" value="04514,05167,00010"/>
            </conditional>
            <param name="id_type" value="uniprotID"/>
            <param name="species" value="hsa"/>
            <param name="native" value="true"/>            
            <output name="kegg" file="hsa04514.pathview.png" compare="sim_size"/>
            <output name="kegg" file="hsa05167.pathview.png" compare="sim_size"/>
            <output name="kegg" file="hsa00010.pathview.png" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
        usage: ./PathView.R [-h] [-i INPUT] [-l ID_LIST] [-p PATHWAYS_ID]
                    [-n PATHWAYS_NAME] [-s SPECIES] [-t ID_TYPE]
                    [-c ID_COLUMN] [-e1 EXPRESSION_VALUES1]
                    [-e2 EXPRESSION_VALUES2] [-e3 EXPRESSION_VALUES3]
                    [--header HEADER] [--native_kegg NATIVE_KEGG]
    ]]></help>
    <citations>
        <citation type="doi">10.1093/nar/gkx372</citation>
        <citation type="bibtex">
@misc{renameTODO,
  author = {Weijun Luo},
  year = {2013},
  title = {pathview},
  url = {https://bioconductor.org/packages/release/bioc/html/pathview.html},
}</citation>
    </citations>
</tool>
