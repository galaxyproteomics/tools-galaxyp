<tool id="goP" name="goProfilesP" version="0.1.0">
    <description> Identify enriched biological themes, GO terms from your protein list.
    </description>
    <requirements>
        <!--requirement type="package" version="3.2.1">R</requirement>
        <requirement type="package" version="3.2.3">org.Hs.eg.db</requirement-->
        <!--requirement type="package" version="1.32.0">goProfiles</requirement-->
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        Rscript /projet/galaxydev/galaxy/tools/proteore_uc1/goprofilesP/go.R
        #if $input.ids == "text"
            "$input.text" "text"
        #else 
            "$input.file,$input.ncol,$input.header" "file"
        #end if
        
        #*if $onto_opt=="cc"
            "CC"
        #else if $onto_opt=="mf"
            "MF"
        #else if $onto_opt=="bp"
            "BP"
        #else if $onto_opt=="all"
            "ALL"
        #end if*#
        
        $onto_opt
        
        $opt.plot_opt
        
        $level
        
        $per
        
        "$title"

    ]]></command>
    <inputs>
        <!--param type="data" name="input1" format="txt" label="Input file" help="Input file is a tab-delimited file containing different information of proteins, such as an output of MaxQuant software" />
        <param type="text" name="ncol" value="c1" label="specify the column that contains gene ID to be analysed" help ='For example, fill in "c1" if you want to filter the first column' /-->
        <conditional name="input" >
            <param name="ids" type="select" label="Provide your identifiers (copy/paste or ID list from a one-column file or ID list from a multi-column file (e.g. table)) " >
                <option value="text">Copy/paste your identifiers</option>
                <option value="file">Input file containing your identifiers</option>
            </param>
            <when value="text" >
                <param name="text" type="text" label="Copy/paste your identifiers" help='IDs must be separated by spaces or new lines, into the form field, for example:P31946 P62258 
or
 
P04259

P13647 ' />
            </when>
            <when value="file" >
                <param name="file" type="data" format="txt,tabular" label="Choose a one column file that contains your list of IDs" help="This file should contain only 1 column, each rows is an ID" />
                <param name="ncol" type="text" label="The column number of IDs to map" help='For example, fill in "c1" if it is the first column, "c2" if it is the second column and so on' />
                <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file contain header?" />
            </when>
        </conditional>
        <param type="select" name="onto_opt" label="Please select GO terms category" multiple="True" display="checkboxes" >
            <option value="CC">Cellular Component (CC)</option>
            <option value="MF">Molecular Function (MF)</option>
            <option value="BP">Biological Process (BP)</option>
            <!--option value="all">All</option-->
        </param>
        <param type="select" name="level" label="Level of the ontology at which the profile has to be built (the higher this number, the deeper the GO level)" >
            <option value="1">1</option>
            <option value="2" selected="True">2</option>
            <option value="3">3</option>
        </param>
        <param type="boolean" name="per" label="Plot absolute or relative frequencies (not summing to 100)" truevalue="TRUE" falsevalue="FALSE" />
        <param type="text" name="title" label="Enter title of your figure" />
        <section name="opt" title="Choose graphical output (bar plots) format: png, jpeg, pdf" expanded="False" help="By default, PDF is chosen as output format">
            <param type="select" name="plot_opt" label="Choose plot output extension" multiple="True" display="checkboxes" >
                <option value="PNG">PNG</option>
                <option value="JPEG">JPEG</option>
                <option value="PDF" selected="True">PDF</option>
            </param>
        </section>
    </inputs>
    <outputs>
        <!--data name="output_png" format="png" label="GO Profile - PNG" >
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png"  format="png"/>
            <filter>"PNG" in plot_opt</filter>
        </data>
        <data name="output_jpeg" format="jpeg" label="GO Profile - JPEG" >
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.jpeg"  format="jpg"/>
            <filter>"JPEG" in plot_opt</filter>
        </data>
        <data name="output_pdf" format="pdf" label="GO Profile - PDF" >
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.pdf"  format="pdf"/>
            <filter>"PDF" in opt.plot_opt</filter>
        </data>
	    <!-collection type="list" label="GO Profile diagram output" name="output" >
	        <discover_datasets pattern="(?P&lt;designation&gt;.+\.png)" ext="png" />
		    <filter>"PNG" in plot_opt</filter>
		</collection>
		<collection type="list" label="GO Profile - JPEG" name="output_jpeg" >
	        <discover_datasets pattern="(?P&lt;designation&gt;.+.jpeg)" ext="jpg" />
		    <filter>"JPEG" in plot_opt</filter>
		</collection>
	    <collection type="list" label="GO Profile - PDF" name="output_pdf" >
	        <discover_datasets pattern="(?P&lt;designation&gt;.+)\.pdf" ext="pdf" />
		    <filter>"PDF" in opt.plot_opt</filter>
	    </collection-->
	    <collection type="list" label="GO Profile diagram outputs" name="output" >
	        <discover_datasets pattern="(?P&lt;designation&gt;.+\.png)" ext="png" />
	        <discover_datasets pattern="(?P&lt;designation&gt;.+\.jpeg)" ext="jpg" />
	        <discover_datasets pattern="(?P&lt;designation&gt;.+\.pdf)" ext="pdf" />
	    </collection>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="ids" value="file" />
                <param name="file" value="UnipIDs.txt" />
                <param name="ncol" value="c1" />
                <param name="header" value="false" />               
            </conditional>
            <param name="onto_opt" value="CC,MF,BP" />
            <param name="level" value="2" />
            <param name="per" value="true" />
            <param name="title" value="Test" />
            <section name="opt" >
                <param name="plot_opt" value="PDF" />
            </section>
            <output_collection name="output" type="list" >
                <element name="profile.BP.pdf" file="profile.BP.pdf" ftype="pdf" />
                <element name="profile.MF.pdf" file="profile.MF.pdf" ftype="pdf" />
                <element name="profile.CC.pdf" file="profile.CC.pdf" ftype="pdf" />
            </output_collection>
        </test>
    </tests>
    <help><![CDATA[
This tool , based on the GoProfiles R package, performs Gene Ontology (GO) based analysis for gene sets (from ‘Entrez’) or other type of biological identifiers (Uniprot, BiocProbes or GoTermsFrame) which can be annotated in the Gene Ontology. You can choose one or more GO categories, GO level at which the profile has to be built, display and/or export bar plots (with absolute or relative frequencies), for more details, please read: <I> Salicrú M, Ocaña J, Sánchez-Pla A. Comparison of lists of genes based on functional profiles. BMC Bioinformatics. 2011;12:401. </I> 

If your identifiers type is not support here, please use the ID mapping component in ProteoRE section to convert the IDs type first.
    ]]></help>
    <citations>
    </citations>
</tool>
