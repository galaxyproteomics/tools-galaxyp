<tool id="heatmap" name="heatmap visualization (heatmaply)" version="2018.09.12">
    <requirements>
        <requirement type="package" version="4.7.1">r-plotly</requirement>
        <requirement type="package" version="0.14.1">r-heatmaply</requirement>
        <requirement type="package" version="2.1.1">phantomjs</requirement>
        <requirement type="package" version="2.2.1">pandoc</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript $__tool_directory__/heatmap_viz.R --input='$file' --output="$file.name"  --type='$output_type' --cols='$select_data_columns.cols' 
            --row_names=$rownames --header='$header' --col_text_angle='$angle_col'
    ]]></command>
    <inputs>
        <param name="file" type="data" format="txt,tabular" label="Select a file (uto table)" help="" />
        <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file contain header?" />
        <conditional name="select_data_columns">
            <param name="enter_cols" type="select" label="Select columns or a range of columns to be used for heatmap building">
                <option value="cols_number">Select columns to be used one by one</option>
                <option value="cols_range">Select a range of columns to be used</option>
            </param>
            <when value="cols_number">
                <param name="cols" type="text" label="Enter data columns to use for the heatmap separated by commas" help="For example : c3,c5,c7"/>
            </when>
            <when value="cols_range">
                <param name="cols" type="text" label="Enter a range of data columns to use for the heatmap, first and last column separated bay ':'" help="For example : c2:c7"/>
            </when>
        </conditional>
        <param name="rownames" type="text" value="c1" label="Enter the column to use for row labels" help="for example : c1"/>
        <param type="integer" name="angle_col" label="Angle of column labels" value="0" min="-90" max="90" />
        <param name="output_type" type="select" label="Choose the output format">
            <option value="html">html</option>
            <option value="pdf">pdf</option>
            <option value="jpeg">jpeg</option>
            <option value="png">png</option>
        </param>
    </inputs>
    <outputs>
        <data name="output" format="html">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.html" ext="html" visible="true" assign_primary_output="true"/>
                <filter>output_type=="html"</filter>
        </data>
        <data name="pdf" format="pdf">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.pdf" ext="pdf" visible="true" assign_primary_output="true"/>
                <filter>output_type=="pdf"</filter>
        </data>
        <data name="jpeg" format="jpg">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.jpg" ext="jpg" visible="true" assign_primary_output="true"/>
                <filter>output_type=="jpeg"</filter>
        </data>
        <data name="png" format="png">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" ext="png" visible="true" assign_primary_output="true"/>
                <filter>output_type=="png"</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <output name="output" file="heatmap.html"/>
        </test>
    </tests>
    <help><![CDATA[
        Pathview R script
        Arguments:
        --help                  Print this test
        --input                 path of the input  file (must contains a colum of uniprot and/or geneID accession number)
        --output                Output name of file, could be .png, .jpeg, .pdf or .html
        --cols                  Columns to use for heatmap, exemple : '3:8' to use columns from the third to the 8th
        --row_names             Column which contains row names
        --header                True or False
        --col_text_angle        Angle of columns label ; from -90 to 90 degres

        Example:
        ./heatmap_viz.R --input='dat.nucl.norm.imputed.tsv' --output='heatmap.html' --cols='3:8' --row_names='2' --header=TRUE --col_text_angle=0 

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{renameTODO,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {TODO},
  url = {https://plot.ly/r/},
}</citation>
        <citation type="bibtex">
@misc{renameTODO,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {TODO},
  url = {https://cran.r-project.org/package=heatmaply},
}</citation>
    </citations>
</tool>