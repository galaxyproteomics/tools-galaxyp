<tool id="heatmap" name="HeatMap" version="2018.11.08">
    <description>Clustering and visualisation for differential analysis</description>
    <requirements>
        <requirement type="package" version="4.7.1">r-plotly</requirement>
        <requirement type="package" version="0.14.1">r-heatmaply</requirement>
        <requirement type="package" version="2.1.1">phantomjs</requirement>
        <requirement type="package" version="2.2.1">pandoc</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript $__tool_directory__/heatmap_viz.R 
            --input='$file' 
            --output="$file.name"  
            --type='$output_type' 
            --cols='$select_data_columns.cols' 
            --row_names=$rownames 
            --header='$header' 
            --col_text_angle='$angle_col'
            --dist="$distance"
            --clust="$clustering"
            --dendrogram="$dendrogram"

    ]]></command>
    <inputs>
        <param name="file" type="data" format="txt,tabular" label="Select a file (uto table)" help="" />
        <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file have a header?" />
        <conditional name="select_data_columns">
            <param name="enter_cols" type="select" label="Select columns or a range of columns to be used for heatmap building">
                <option value="cols_number">Select columns to be used one by one</option>
                <option value="cols_range">Select a range of columns to be used</option>
            </param>
            <when value="cols_number">
                <param name="cols" type="text" label="Enter data columns to use for the heatmap separated by commas" help="For example : c3,c5,c7"/>
            </when>
            <when value="cols_range">
                <param name="cols" type="text" label="Enter a range of data columns to use for the heatmap, first and last column separated bay ':'" help="For example : c2:c7"/>
            </when>
        </conditional>
        <param name="rownames" type="text" value="c1" label="Enter the column to use for row labels" help="for example : c1"/>
        <param name="distance" type="select" label="Distance measurement method" value="euclidean">
            <option value="euclidean" selected="true">Euclidean</option>
            <option value="pearson" selected="true">Pearson</option>
            <option value="spearman">Spearman</option>
            <option value="kendall">Kendall</option>
            <option value="maximum">Maximum</option>
            <option value="manhattan">Manhattan</option>
            <option value="canberra">Canberra</option>
            <option value="binary">Binary</option>
            <option value="minkowski">Minkowski</option>
        </param>
        <param name="clustering" type="select" label="Clustering method" value="average">
            <option value="ward.D">Ward</option>
            <option value="ward.D2">Ward2</option>
            <option value="single">Single linkage (nearest neighbor)</option>
            <option value="complete">Complete linkage (farthest neighbor</option>
            <option value="average" selected="true">Group average linkage (UPGMA)</option>
            <option value="mcquitty">Simple average method (WPGMA)</option>
            <!--option value="median">Median (WPGMC)</option>
            <option value="centroid">Centroid (UPGMC)</option-->
        </param>
        <param name="dendrogram" type="select" label="Apply clustering on :" value="both">
            <option value="row">Rows</option>
            <option value="column">Columns</option>
            <option value="both" selected="true">Rows and columns</option>
            <option value="none">None</option>
        </param>
        <param type="integer" name="angle_col" label="Angle of column labels" value="0" min="-90" max="90" />
        <param name="output_type" type="select" label="Choose the output format">
            <option value="html">html</option>
            <option value="pdf">pdf</option>
            <option value="jpeg">jpeg</option>
            <option value="png">png</option>
        </param>

    </inputs>
    <outputs>
        <data name="output" format="html">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.html" ext="html" visible="true" assign_primary_output="true"/>
                <filter>output_type=="html"</filter>
        </data>
        <data name="pdf" format="pdf">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.pdf" ext="pdf" visible="true" assign_primary_output="true"/>
                <filter>output_type=="pdf"</filter>
        </data>
        <data name="jpeg" format="jpg">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.jpg" ext="jpg" visible="true" assign_primary_output="true"/>
                <filter>output_type=="jpeg"</filter>
        </data>
        <data name="png" format="png">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" ext="png" visible="true" assign_primary_output="true"/>
                <filter>output_type=="png"</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <output name="output" file="heatmap.html"/>
        </test>
    </tests>
    <help><![CDATA[

This tool creates a heatmap from a tsv file (tab delimited).

Input file must have a column for rows labels and colums with numeric data to be used for clustering.

See table below for an example input file

.. csv-table:: Example file
   :header: "Uniprot","iBAQ_CTR1","iBAQ_CTR2","iBAQ_CTR3","iBAQ_pTCN1","iBAQ_pTCN2","iBAQ_pTCN3"


   "Q49AN9",17.4091970440807,16.0474907255521,14.9687330755858,21.8454060245779,18.9468529040903,21.2330797498008
   "O00148",14.1001686145694,14.806777888004,15.3555560564928,17.2942797505583,18.2106568817514,16.9479095182613
   "F5H6E2",15.0235503328855,16.6142578028388,20.5969569088489,14.6615767253835,17.9752549753108,20.4023495267791
   "E9PPW7",18.0770953690935,15.312218369812,13.8048301075204,17.5522130063356,15.9664520099065,15.1597932646987
   "O00483",17.4188205774495,16.783665086968,15.1589556127476,19.7398973660168,20.8648965533665,20.1781898785682
   "O00571",12.9049717044645,16.717296441372,13.8708732177805,19.8879681981565,21.0815521014477,17.4710040202845

~

You can choose the columns to be used to create the heatmap.

You can add manually each colums of interest or enter a range of columns to use.

You then entered the column number of the column you want to be used for the rows labels .

If you have long string in your header, you might want to incline the column labels for better reading.

Default output is html, it allows you to zoom and have row an column labels of a cell by passing your cursor on it.

You can select pdf, jpeg or png if you want a static output.

-----

.. class:: infomark

**Authors**

David Christiany, Florence Combes, Yves Vandenbrouck CEA, INSERM, CNRS, Grenoble-Alpes University, BIG Institute, FR

Sandra Dérozier, Olivier Rué, Christophe Caron, Valentin Loux INRA, Paris-Saclay University, MAIAGE Unit, Migale Bioinformatics platform

This work has been partially funded through the French National Agency for Research (ANR) IFB project.

Contact support@proteore.org for any questions or concerns about the Galaxy implementation of this tool.

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{renameTODO,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {TODO},
  url = {https://plot.ly/r/},
}</citation>
        <citation type="bibtex">
@misc{renameTODO,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {TODO},
  url = {https://cran.r-project.org/package=heatmaply},
}</citation>
    </citations>
</tool>