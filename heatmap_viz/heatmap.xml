<tool id="heatmap" name="HeatMap" version="2018.10.12">
    <description>Clustering and visualisation for differential analysis</description>
    <requirements>
        <requirement type="package" version="4.7.1">r-plotly</requirement>
        <requirement type="package" version="0.14.1">r-heatmaply</requirement>
        <requirement type="package" version="2.1.1">phantomjs</requirement>
        <requirement type="package" version="2.2.1">pandoc</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript $__tool_directory__/heatmap_viz.R --input='$file' --output="$file.name"  --type='$output_type' --cols='$select_data_columns.cols' 
            --row_names=$rownames --header='$header' --col_text_angle='$angle_col'
    ]]></command>
    <inputs>
        <param name="file" type="data" format="txt,tabular" label="Select a file (uto table)" help="" />
        <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file have a header?" />
        <conditional name="select_data_columns">
            <param name="enter_cols" type="select" label="Select columns or a range of columns to be used for heatmap building">
                <option value="cols_number">Select columns to be used one by one</option>
                <option value="cols_range">Select a range of columns to be used</option>
            </param>
            <when value="cols_number">
                <param name="cols" type="text" label="Enter data columns to use for the heatmap separated by commas" help="For example : c3,c5,c7"/>
            </when>
            <when value="cols_range">
                <param name="cols" type="text" label="Enter a range of data columns to use for the heatmap, first and last column separated bay ':'" help="For example : c2:c7"/>
            </when>
        </conditional>
        <param name="rownames" type="text" value="c1" label="Enter the column to use for row labels" help="for example : c1"/>
        <param type="integer" name="angle_col" label="Angle of column labels" value="0" min="-90" max="90" />
        <param name="output_type" type="select" label="Choose the output format">
            <option value="html">html</option>
            <option value="pdf">pdf</option>
            <option value="jpeg">jpeg</option>
            <option value="png">png</option>
        </param>
    </inputs>
    <outputs>
        <data name="output" format="html">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.html" ext="html" visible="true" assign_primary_output="true"/>
                <filter>output_type=="html"</filter>
        </data>
        <data name="pdf" format="pdf">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.pdf" ext="pdf" visible="true" assign_primary_output="true"/>
                <filter>output_type=="pdf"</filter>
        </data>
        <data name="jpeg" format="jpg">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.jpg" ext="jpg" visible="true" assign_primary_output="true"/>
                <filter>output_type=="jpeg"</filter>
        </data>
        <data name="png" format="png">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" ext="png" visible="true" assign_primary_output="true"/>
                <filter>output_type=="png"</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <output name="output" file="heatmap.html"/>
        </test>
    </tests>
    <help><![CDATA[

This tool creates a heatmap from a tsv file (tab delimited).

Input file must have a column for rows labels and colums with numeric data to be used for clustering.

See table below for an example input file

.. csv-table:: Example file
   :header: "Uniprot","iBAQ_CTR1","iBAQ_CTR2","iBAQ_CTR3","iBAQ_pTCN1","iBAQ_pTCN2","iBAQ_pTCN3"


   "Q49AN9",17.4091970440807,16.0474907255521,14.9687330755858,21.8454060245779,18.9468529040903,21.2330797498008
   "O00148",14.1001686145694,14.806777888004,15.3555560564928,17.2942797505583,18.2106568817514,16.9479095182613
   "F5H6E2",15.0235503328855,16.6142578028388,20.5969569088489,14.6615767253835,17.9752549753108,20.4023495267791
   "E9PPW7",18.0770953690935,15.312218369812,13.8048301075204,17.5522130063356,15.9664520099065,15.1597932646987
   "O00483",17.4188205774495,16.783665086968,15.1589556127476,19.7398973660168,20.8648965533665,20.1781898785682
   "O00571",12.9049717044645,16.717296441372,13.8708732177805,19.8879681981565,21.0815521014477,17.4710040202845
   "O14880",15.7795152357562,16.9056638034428,13.337884572062,17.7044082430845,18.2623291335539,15.6013730432451
   "O15020",13.2364391435825,16.0875734675595,17.3471072965076,11.3932084948267,17.5224254853992,16.0210381525735
   "O43172",14.0986553604854,14.9471566023657,14.6745546404104,20.0511708977192,20.4174260826947,17.9102233324039
   "Q5SZU1",14.8343706352117,14.9336932868586,15.863517960295,16.5553115638733,13.2384247130195,15.6278162199574
   "O43181",16.9585411843144,18.0253414246133,14.9688011176101,18.4506581478283,18.060715749432,17.1508218902826
   "O43395",12.7815915377713,13.2570182327942,14.2151159490732,18.7982994745559,19.0606274400876,17.2081917897096
   "O43707",14.4053518406046,14.9335246225864,16.7473467820106,13.9490316421179,12.6512953774468,12.488509829076
   "O43795",16.6433848083358,15.6311118029749,20.0692252954892,14.1953551525139,16.1740085549157,19.5449370166335
   "O43809",18.8780918275901,15.5053991792138,10.6705596934982,20.0325214098905,19.0562345939939,18.8788858733645
   "O43920",17.8555846173049,16.0317021406993,15.4193073529273,17.0748503358331,18.6638138225965,15.2226042707806
   "C9JZR2",12.7604492273804,15.1102454594255,13.2719163803705,14.2208765008612,16.2566097942392,16.1902621154649
   "O75152",15.6680820455343,15.0519438286799,11.6759710588754,17.1958169834068,18.1627806617006,17.7637389118576
   "O75251",16.0380636771286,17.3118540988743,14.8408713638196,18.2933996427914,19.2469406522803,17.7901518813423
   "O75306",17.7731476104228,17.0436820947162,14.3216198760797,18.0682714348397,17.7038323287087,17.4649529913645
   "O75369",10.5809642077475,15.1397204878621,14.9763339043522,14.4145798670977,13.0731660922891,10.2481720848799
   "O75489",17.9752051061699,18.5422711615252,15.8278574543733,17.7647633731306,19.0794616174147,14.6897924274007
   "O75533",10.7492978788409,11.6906933545874,12.3558422513063,16.0541183067786,18.1338889547966,18.1993226892225
   "O75643",9.56772460294106,14.5115371196252,12.6720983186065,19.6873642615915,19.968822501587,19.1004765946838
   "O75746",17.9078927655008,11.3730435111001,10.0131616287334,18.185826994594,13.1691675113752,15.1221180214157
   "O94776",11.3490449754863,13.197432796574,11.5083281047808,14.5931066465682,16.4802205283196,16.5456932336907
   "O94832",16.7310585463838,17.2925285377812,19.8521284451617,14.8901614386487,18.1901635960251,19.1007398885939
   "O94906",14.6213840503359,13.6515629350167,9.1203482682031,18.6422967033089,19.6520809706827,18.5888550328822
   "O95168",20.5206925179917,20.8313406769694,16.0118017974777,17.8571177393245,20.8185612151699,19.4884749760408
   "A0A087WXC5",18.2572586904791,18.4546534154334,15.203018002337,19.220193815815,19.5429473866248,14.1031742766836

~

You can choose the columns to be used to create the heatmap.

You can add manually each colums of interest or enter a range of columns to use.

You then entered the column number of the column you want to be used for the rows labels .

If you have long string in your header, you might want to incline the column labels for better reading.

Default output is html, it allows you to zoom and have row an column labels of a cell by passing your cursor on it.

You can select pdf, jpeg or png if you want a static output.

-----

.. class:: infomark

**Authors**

David Christiany, Florence Combes, Yves Vandenbrouck CEA, INSERM, CNRS, Grenoble-Alpes University, BIG Institute, FR

Sandra Dérozier, Olivier Rué, Christophe Caron, Valentin Loux INRA, Paris-Saclay University, MAIAGE Unit, Migale Bioinformatics platform

This work has been partially funded through the French National Agency for Research (ANR) IFB project.

Contact support@proteore.org for any questions or concerns about the Galaxy implementation of this tool.


        Pathview R script
        Arguments:
        --help                  Print this test
        --input                 path of the input  file (must contains a colum of uniprot and/or geneID accession number)
        --output                Output name of file, could be .png, .jpeg, .pdf or .html
        --cols                  Columns to use for heatmap, exemple : '3:8' to use columns from the third to the 8th
        --row_names             Column which contains row names
        --header                True or False
        --col_text_angle        Angle of columns label ; from -90 to 90 degres

        Example:
        ./heatmap_viz.R --input='dat.nucl.norm.imputed.tsv' --output='heatmap.html' --cols='3:8' --row_names='2' --header=TRUE --col_text_angle=0 

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{renameTODO,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {TODO},
  url = {https://plot.ly/r/},
}</citation>
        <citation type="bibtex">
@misc{renameTODO,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {TODO},
  url = {https://cran.r-project.org/package=heatmaply},
}</citation>
    </citations>
</tool>