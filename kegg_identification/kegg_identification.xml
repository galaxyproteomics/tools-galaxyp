<tool id="kegg_identification" name="KEGG pathways identification" version="2018.12.12">
    <description>and coverage</description>
    <requirements>
        <requirement type="package" version="1.18.0">bioconductor-keggrest</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript $__tool_directory__/kegg_identification.R  
        
        #if $input.ids == "text"
            --id_list="$input.txt"
        #else
            --input="$input.file"
            --id_column="$input.ncol"
            --header="$input.header"
        #end if
        
        --id_type="$id_type"
        --output="$output1"
        --nb_pathways="$nb_pathways"
        --species="$species"

    ]]></command>
    <inputs>
        <conditional name="input" >
            <param name="ids" type="select" label="Enter your list of identifiers" help="Copy/paste or ID list from a file (e.g. table)" >
                <option value="text">Copy/paste your identifiers</option>
                <option value="file" selected="true">Input file containing your identifiers</option>
            </param>
            <when value="text" >
                <param name="txt" type="text" label="Copy/paste your identifiers" help='IDs must be separated by tab, space or carriage return into the form field, for example: hsa:3306 hsa:22948' >
                    <sanitizer invalid_char=''>
                        <valid initial="string.printable">
                            <remove value="&apos;"/>
                        </valid>
                        <mapping initial="none">
                            <add source="&apos;" target="__sq__"/>
                        </mapping>
                    </sanitizer>
                </param>
            </when>
            <when value="file" >
                <param name="file" type="data" format="txt,tabular,tsv" label="Select a file that contains your list of identifiers" help="" />
                <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file contain a header?" />
                <param name="ncol" type="text" value="c1" label="The column number of your identifiers to map" help='For example, fill in "c1" if it is the first column, "c2" if it is the second column and so on' />
            </when>
        </conditional>
        <param name="id_type" type="select" label="select your identifiers type :" >
            <option value="ncbi-geneid" selected="true">Entrez genes ID</option>
            <option value="kegg-id">KEGG genes ID</option>
            <option value="uniprot">Uniprot Accession number</option>
            
        </param>
        <param name="species" type="select" label="Select species">
            <option value="hsa">Human (H. sapiens)</option>
            <option value="mmu">Mouse (M. musculus)</option>
            <option value="rno">Rat (R. norvegicus)</option>
        </param>
        <param type="integer" name="nb_pathways" label="Set the number of pathways to be displayed in the output" value="10" help="Pathways are sorted by percent of mapping gene by pathway in descending order"/>
    </inputs>
    <outputs>
        <data name="output1" format="tsv" />
    </outputs>
    <tests>
        <test>
            <conditional name="input" >
                <param name="ids" value="file"/>
                <param name="file" value="SPZ.soluble_kegg_id.txt" />
                <param name="header" value="true" />
                <param name="ncol" value="c2" /> 
            </conditional>
            <param name="id_type" value="kegg-id" />
            <param name="species" value="hsa" />
            <param name="nb_pathways" value="20" />
            <output name="output1" value="test.tsv" />
        </test>
    </tests>
    <help><![CDATA[

This tool maps a list of identifiers to KEGG pathway and return a list of KEGG pathways ranked by the percentage of coverage for each pathway. This is done by computing the number of KEGG genes IDs from your list divided by the total number of KEGG genes present in the considered species for each KEGG pathway. 

It allows you to directly identify the signaling pathways that are the most covered by your proteomics dataset. 

By default the number of pathway to be displayed is set to 10 and sorted in descending order. 

At the moment three species are supported: Human (Homo sapiens), Mouse (Mus musculus) and Rat (Rattus norvegicus).

**Input:**

Input can be either a list of ids or a file containing multiple columns but with at least one column of ids (e.g. hsa04970). 
Input ids type can be Entrez gene ID, KEGG gene ID or Uniprot accession number.

.. class:: warningmark  

If you use Uniprot accession number, it will be converted to KEGG gene ID, this step can be time consuming.
If your input file contains other type of ids, please use the ID_Converter tool.

**Output:**

The output is a tabular file (.tsv) with the following columns:

* **Pathway_ID:** KEGG pathway identifier (e.g. hsa04970)
* **Description:** name of the pathway as in KEGG
* **Ratio IDs mapped/total IDs (%):** percentage of pathway coverage
* **nb KEGG genes IDs mapped in the pathway:** number of KEGG genes of your list mapped on the KEGG pathway
* **nb total of KEGG genes IDs present in the pathway:** total number of KEGG genes present in the KEGG pathway

-----

.. class:: infomark

**Database:**

Pathways and KEGG genes IDs are collected via KEGGREST package. 

User manual / Documentation: KEGGREST Bioconductor package https://bioconductor.org/packages/3.1/bioc/html/KEGGREST.html


-----

.. class:: infomark

**Galaxy integration**

David Christiany, Florence Combes, Yves Vandenbrouck CEA, INSERM, CNRS, Grenoble-Alpes University, BIG Institute, FR

Sandra Dérozier, Olivier Rué, Valentin Loux INRA, Paris-Saclay University, MAIAGE Unit, Migale Bioinformatics platform

This work has been partially funded through the French National Agency for Research (ANR) IFB project.

Contact support@proteore.org for any questions or concerns about the Galaxy implementation of this tool.

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubKEGGREST,
  title = {KEGGREST: Client-side REST access to KEGG},
  author = {Dan Tenenbaum},
  year = {2018},
  note = {R package version 1.18.1},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/Bioconductor/KEGGREST},
}</citation>
    </citations>
</tool>
