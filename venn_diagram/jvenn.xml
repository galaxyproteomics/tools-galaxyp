<?xml version="1.0"?>
<!--
# Copyright (C) 2015 INRA
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<tool id="Jvenn" name="Venn diagram plotter" version="1.0">
	<description>An integrative tool for comparing ID lists with Venn Diagrams (based on Jvenn) (up to 6 lists).
	</description>
	<command><![CDATA[
		python /projet/galaxydev/galaxy/tools/proteore_uc1/jvennP/jvenn2.py 
		#*if $mq.opt == "mq_file"
                    --mq "$mq.mq_file" "$mq.name" "mq_file"
                    #if $mq.ncol
                        --ncol $mq.ncol
                    #end if
                #else if $mq.opt == "list_file"
                    --mq "$mq.list_file" "$mq.name" "list_file"
                #else
                    --mq "$mq.list" "$mq.name" "list"
                #end if*#

		#for $i, $s in enumerate($series)
		    --input
		    #if $s.se.input == "mq_file"
		        "$s.se.mq_file" "$s.se.name" "mq_file" "$s.se.header" "$s.se.ncol"
		    ##else if $s.se.input == "list_file"
			    ##"$s.se.list_file" "$s.se.name" "file"
		    #else
                "$s.se.list" "$s.se.name" "list"
 		    #end if
		#end for 
		#*--names
		#for $s in $series
		    #if $s.files
			"$s.files.name"
		#end for *#
		--summary "$output_summary"
	]]></command>
	<inputs>
		<!-- Files ->
		<param type="data" name="mq" format="txt" label="Filtered MaxQuant file" /-->
                <!--conditional name="mq" >
                    <param type="select" name="opt" label="Add a list" >
                        <option value="mq_file">Choose query file</option>
                        <option value="list_file">List of IDs file</option>
                        <option value="list">Enter list of IDs</option>
                    </param>
                    <when value="mq_file">
                        <param type="data" name="mq_file" format="txt" label="Query file" />
		            	<param type="text" name="ncol" value="c1" label="The column number which contains IDs to compare" optional="True" help ='If no column is specified, the tool will look for column "Majority protein IDs"' />
		            	<param type="text" name="name" value="" label="Enter the name of this list" help="This name will be displayed on venn diagram" />
                    </when>
                    <when value="list_file">
                        <param type="data" name="list_file" format="txt" label="List of IDs file" />
                        <param type="text" name="name" value="" label="Enter the name of this list" help="This name will be displayed on venn diagram" />
                    </when>
                    <when value="list">
                        <param type="text" name="list" label="Enter list of IDs" />
                        <param type="text" name="name" value="" label="Enter the name of this list" help="This name will be displayed on venn diagram" />
                    </when>
                </conditional-->
		<repeat name="series" title="Lists to compare" min="2" max="5" >
            <conditional name="se" >
                    <param type="select" name="input" label="Input" >
                        <option value="list">Copy/paste your list of IDs </option>
                        <option value="mq_file">Choose a multiple-columns file</option>
                        <!--option value="list_file">Choose a single-column file</option-->
                        
                    </param>
                    <when value="mq_file">
                        <param type="data" name="mq_file" format="txt,tab" label="Choose a multiple-columns file" help="Input file is a tab-delimited file containing different information of proteins, such as an output of MaxQuant software" />
                        <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file contain header?" />
		            	<param type="text" name="ncol" value="c1" label="Please specify the column where you would like to apply the comparison" help ='For example, fill in "c1" if you want to filter the first column' />
		            	<param type="text" name="name" value="" label="Please enter the name of this list" help="This name will be displayed on venn diagram" />
                    </when>
                    <!--when value="list_file">
                        <param type="data" name="list_file" format="txt" label="Choose a single-column file" />
                        <param type="text" name="name" value="" label="Please enter the name of this list" help="This name will be displayed on venn diagram" />
                    </when-->
                    <when value="list">
                        <param type="text" name="list" label="Copy/paste your list of IDs " />
                        <param type="text" name="name" value="" label="Please enter the name of this list" help="This name will be displayed on venn diagram" />
                    </when>
                </conditional>
		</repeat>
	</inputs>
	<outputs>
		<data format="html" name="output_summary" label="Jvenn diagram" from_work_dir="summary.html" />
		<!--collection type="list" label="Protein list comparison" name="output_list" >
			<discover_datasets pattern="(?P&lt;designation&gt;.+_common).txt" ext="txt" />
			<discover_datasets pattern="(?P&lt;designation&gt;.+_specific).txt" ext="txt" />
		</collection-->
		<collection type="list" label="Text output of Venn diagram" name="output_venn" >
		    <discover_datasets pattern="(?P&lt;designation&gt;.+_venn).txt" ext="txt" />
		</collection>
	</outputs>
	<tests>
	    <test>
	        <repeat name="series">
	            <conditional name="se">
	                <param name="input" value="mq_file" />
	                <param name="mq_file" value="DESeq.txt" />
	                <param name="header" value="false" />
	                <param name="ncol" value="c1" />
	                <param name="name" value="DESeq" />
	            </conditional>
	        </repeat>
	        <repeat name="series">
	            <conditional name="se">
	                <param name="input" value="mq_file" />
	                <param name="mq_file" value="FQ.txt" />
	                <param name="header" value="false" />
	                <param name="ncol" value="c1" />
	                <param name="name" value="FQ" />
	            </conditional>
	        </repeat>
	        <repeat name="series">
	            <conditional name="se">
	                <param name="input" value="mq_file" />
	                <param name="mq_file" value="RPKM.txt" />
	                <param name="header" value="false" />
	                <param name="ncol" value="c1" />
	                <param name="name" value="RPKM" />
	            </conditional>
	        </repeat>
	        <repeat name="series">
	            <conditional name="se">
	                <param name="input" value="mq_file" />
	                <param name="mq_file" value="TC.txt" />
	                <param name="header" value="false" />
	                <param name="ncol" value="c1" />
	                <param name="name" value="TC" />
	            </conditional>
	        </repeat>
	        <repeat name="series">
	            <conditional name="se">
	                <param name="input" value="mq_file" />
	                <param name="mq_file" value="TMM.txt" />
	                <param name="header" value="false" />
	                <param name="ncol" value="c1" />
	                <param name="name" value="TMM" />
	            </conditional>
	        </repeat>
	        <repeat name="series">
	            <conditional name="se">
	                <param name="input" value="mq_file" />
	                <param name="mq_file" value="UQ.txt" />
	                <param name="header" value="false" />
	                <param name="ncol" value="c1" />
	                <param name="name" value="UQ" />
	            </conditional>
	        </repeat>
	        <output name="output_summary" file="summary.html" />
	        <output name="output_text" file="text_venn.txt" />
	        <!--output_collection name="output_text" type="list" >
	            <discovered_dataset designation="text" ftype="tabular" />
	        </output_collection-->
	                
	    </test>
	</tests>
	<help>

This tool draw a venn diagram from lists/files using Jvenn plug-in. It also creates output files that contain common or specific elements between query and each compared lists/files.

.. class:: h3

Inputs

	* **Query file:** A file containing different information of proteins, could be output of previous components.

	* **File of a list of IDs:** .TXT format, each line contains 1 ID

 		AMY1A
 		
 		ALB
 		
 		IGKC
 		
 		CSTA
 		
 		IGHA1
 		
 		ACTG1

 	* **List of IDs:** IDs separated by a space

  		AMY1A ALB IGKC CSTA IGHA1 ACTG1

If you choose a multiple-columns file, it is necessary to specify the column where you would like to perform the comparison.

.. class:: h3

Outputs

**Summary file** (Jvenn_html.html):

Venn diagram: Could be downloaded as image (PNG, SVG)

**Common/specific files**

Text files containing common/specific elements between query and each compared lists/files.

	</help> 
	<citations>
    </citations>
</tool>
