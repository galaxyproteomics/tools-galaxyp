<tool id="build_protein_interaction_maps" name="Build protein interaction maps" version="2019.03.04">
    <requirements>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        python $__tool_directory__/build_protein_interaction_maps.py 
            #if $input.ids == "text"
                --input="$input.txt"
                --input_type="text"
            #else
                --input="$input.file"
                --ncol="$input.ncol"
                --header="$input.header"
                --input_type="file"
            #end if
            --database=$database.ref
            #if $database.ref=="biogrid" 
                --species="${ filter( lambda x: str( x[3] ) == str( $database.ref_file ), $__app__.tool_data_tables['proteore_biogrid_dictionaries'].get_fields() )[0][2] }"
            #else 
                --species="Human"
            #end if

            #if 'PPI_dictionaries' in str($database.ref_file).split('/') : 
                --dict_path="$database.ref_file"
            #else
                --dict_path="$__tool_directory__/$database.ref_file"
            #end if

            #if $input.ids == "file"
                --network_output="$network_output"
                --nodes_output="$nodes_output"
            #else 
                --network_output="$network_output_from_list"
                --nodes_output="$nodes_output_from_list"
            #end if
            --id_type=$database.id_type

    ]]></command>
    <inputs>
        <conditional name="input">
            <param name="ids" type="select" label="Enter IDs" help="Copy/paste or from a file (e.g. table)">
                <option value="text">Copy/paste your identifiers</option>
                <option value="file" selected="true">Input file containing IDs</option>
            </param>
            <when value="text">
                <param name="txt" type="text" label="Copy/paste IDs" help='IDs must be separated by tab, space or carriage return into the form field, for example: P31946 P62258' >
                    <sanitizer invalid_char="">
                        <valid initial="string.printable">
                            <remove value="&apos;"/>
                        </valid>
                        <mapping initial="none">
                            <add source="&apos;" target="__sq__"/>
                            <add source="&#x20;" target=""/>
                            <add source="&#xA;" target=""/>
                            <add source="&#xD;" target=""/>
                            <add source="&#x9;" target=""/>
                        </mapping>
                    </sanitizer>
                </param>
            </when>
            <when value="file" >
                <param name="file" type="data" format="txt,tabular" label="Select your file" help="" />
                <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does file contain header?" />
                <param name="ncol" type="text" value="c1" label="Column number of IDs to map" help='For example, fill in "c1" if it is the first column, "c2" if it is the second column and so on'>
                    <validator type="regex" message="Please enter a column number, for example: 'c1' for the first column">[c]{0,1}[0-9]+</validator>
                </param>
            </when>
        </conditional>
        <conditional name="database">
            <param name="ref" type="select" label="Select database">
                <option value="biogrid">BioGRID</option>
                <option value="bioplex">Human Bioplex 2.0</option>
                <option value="humap">Human protein complex Map (Hu.map)</option>
            </param>
            <when value="biogrid">
                <param name="id_type" type="select" label="Type/source of IDs" optional="false" >
                    <option value="GeneID" >Entrez gene ID</option>
                </param>
                <param name="ref_file" type="select" label="Species">
                    <options from_data_table="proteore_biogrid_dictionaries" />
                </param>
            </when>
            <when value="bioplex">
                <param name="id_type" type="select" label="Type/source of IDs" optional="false">
                    <option value="UniProt-AC" selected="True" >UniProt accession number</option>
                    <option value="GeneID">Entrez gene ID</option>
                </param>
                <param name="ref_file" type="select" label="Species">
                    <options from_data_table="proteore_bioplex_dictionaries" />
                </param>
            </when>
            <when value="humap">
                <param name="id_type" type="select" label="Type/source of IDs" optional="false" >
                    <option value="GeneID" >Entrez gene ID</option>
                </param>
                <param name="ref_file" type="select" label="Species">
                    <options from_data_table="proteore_humap_dictionaries" />
                </param>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="network_output_from_list" format="tsv" label="Network_${database.ref}_from_ids_list">
            <filter>input['ids'] == "text" </filter>
        </data>
        <data name="network_output" format="tsv" label="Network_${database.ref}_from_${input.file.name}">
            <filter>input['ids'] == "file" </filter>
        </data>
        <data name="nodes_output_from_list" format="tsv" label="Nodes_${database.ref}_from_ids_list">
            <filter>input['ids'] == "text"</filter>
        </data>
        <data name="nodes_output" format="tsv" label="Nodes_${database.ref}_from_${input.file.name}">
            <filter>input['ids'] == "file"</filter>
        </data>
    </outputs>
    <help><![CDATA[
**Description**

-----

**Input**

Id list of Entrez gene ID or Uniprot-AC from copy/paste or file

-----

**Parameters**

- **biogrid**
- **bioplex**
- **hu.map**

-----

**Output**

- **network_file**
- **nodes_file**

-----

**Data sources (release date)**

This tool uses the following interactomes:

**biogrid**

- BIOGRID-ORGANISM-Homo_sapiens-3.5.167.tab2.txt
- BIOGRID-ORGANISM-Mus_musculus-3.5.167.tab2.txt
- BIOGRID-ORGANISM-Rattus_norvegicus-3.5.167.tab2.txt
- NCBI2Reactome.txt: 'https://www.reactome.org/download/current/NCBI2Reactome.txt'

from https://downloads.thebiogrid.org/BioGRID/Release-Archive/BIOGRID-3.5.167/

**bioplex**

- BioPlex_interactionList_v4a.tsv: http://bioplex.hms.harvard.edu/data/BioPlex_interactionList_v4a.tsv
- UniProt2Reactome.txt: https://downloads.thebiogrid.org/BioGRID/Release-Archive/BIOGRID-3.5.167/
- NCBI2Reactome.txt: 'https://www.reactome.org/download/current/NCBI2Reactome.txt'

**Human protein complex Map (Hu.map)**

- nodeTable.txt: http://proteincomplexes.org/static/downloads/nodeTable.txt
- pairsWprob: http://proteincomplexes.org/static/downloads/pairsWprob.txt
- NCBI2Reactome.txt: 'https://www.reactome.org/download/current/NCBI2Reactome.txt'

-----

.. class:: infomark

**Authors**

David Christiany, Florence Combes, Yves Vandenbrouck CEA, INSERM, CNRS, Grenoble-Alpes University, BIG Institute, FR

Sandra Dérozier, Olivier Rué, Christophe Caron, Valentin Loux INRA, Paris-Saclay University, MAIAGE Unit, Migale Bioinformatics platform, FR

This work has been partially funded through the French National Agency for Research (ANR) IFB project.

Contact support@proteore.org for any questions or concerns about the Galaxy implementation of this tool.
    ]]></help>
</tool>