<tool id="cluter_profiler" name="clusterProfiler Enrichment Analysis" version="0.1.0">
    <requirements>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript "$__tool_directory__/GO-enrich.R"
        #if $input.ids == "text"
            --input_type="text"
            --input="$input.text"
        #else
            --input_type="file"
            --input="$input.file"
            --ncol="$input.ncol"
            --header="$input.header"
        #end if
        
        --id_type="$idti.idtypein"

        --species="$species"
        
        --onto_opt="$ontology"
        
        --level="$level"
        
        --pval_cutoff="$pval"

        --qval_cutoff="$qval"

        --text_output="$text_output"
    ]]></command>
    <inputs>
        <conditional name="input" >
            <param name="ids" type="select" label="Provide your identifiers" help="Copy/paste or ID list from a file (e.g. table)" >
                <option value="text">Copy/paste your identifiers</option>
                <option value="file">Input file containing your identifiers</option>
            </param>
            <when value="text" >
                <param name="txt" type="text" label="Copy/paste your identifiers" help='IDs must be separated by spaces into the form field, for example: P31946 P62258' >
                    <sanitizer>
                        <valid initial="string.printable">
                            <remove value="&apos;"/>
                        </valid>
                        <mapping initial="none">
                            <add source="&apos;" target="__sq__"/>
                        </mapping>
                    </sanitizer>
                </param>
            </when>
            <when value="file" >
                <param name="file" type="data" format="txt,tabular" label="Choose a file that contains your list of IDs" help="" />
                <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file contain header?" />
                <param name="ncol" type="text" label="The column number of IDs to map" help='For example, fill in "c1" if it is the first column, "c2" if it is the second column and so on' />                
            </when>
        </conditional>
        <conditional name="idti" >
            <param name="idtypein" type="select" label="Select type/source of identifier of your list" help="Please see example of IDs in help section" >
                <option value="Uniprot">UniProt accession number</option>
                <option value="Entrez">Entrez Gene ID</option>
            </param>
            <when value="Uniprot"/>
            <when value="Entrez"/>
        </conditional>
        <param name="species" type="select" label="Select a species" >
            <option value="human">Human</option>
            <option value="mouse">Mouse</option>
            <option value="rat">Rat</option>
        </param>
        <param name="ontology" type="select" display="checkboxes" multiple="true" label="Please select GO terms category">
            <option value="CC">Cellular Component</option>
            <option value="BP">Biological Process</option>
            <option value="MF">Molecular Function</option>
        </param>
        <param name="level" type="select" label="Level of the ontology at which the profile has to be built (the higher this number, the deeper the GO level)">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3" selected="True">3</option>
        </param>
        <param name="pval" type="float" value="0.01" label="P-value cut off"/>
        <param name="qval" type="float" value="0.05" label="Q-value cut off"/>
    </inputs>
    <outputs>
        <data name="text_output" format="tabular" label="clusterProfiler text output" />
        <collection type="list" label="clusterProfiler diagram outputs" name="output" >
	    <discover_datasets pattern="(?P&lt;designation&gt;.+\.png)" ext="png" />
	</collection>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
