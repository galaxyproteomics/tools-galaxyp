/*! unipept-visualizations 1.1.0 05-07-2017 */

"use strict";var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a){return a&&a.__esModule?a:{default:a}}var e=c(1),f=(d(e),c(5)),g=(d(f),c(7));d(g)},function(a,b,c){function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){function c(){G=d3.select("body").append("div").attr("id",a.id+"-tooltip").attr("class","tip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background-color","white").style("padding","2px").style("border","1px solid #dddddd").style("border-radius","3px;")}function d(){var a=d3.scale.linear().range([0,2*Math.PI]);J=d3.svg.arc().outerRadius(g).startAngle(0).endAngle(function(b){return a(b.data.self_count/b.data.count)||0})}function e(a){var b=this;I.domain([0,a.data.count]),E=a,E.x0=A.height/2,E.y0=0,E.setSelected(!0),E.children.forEach(function(a,c){a.color=d3.functor(A.colors).call(b,a,c),a.setRecursiveProperty("color",a.color)}),A.enableExpandOnClick?(E.collapseAll(),E.expand()):E.expandAll(),f(E),n(E)}function f(a){var b=F.nodes(E).reverse(),c=F.links(b);b.forEach(function(a){a.y=a.depth*A.nodeDistance});var d=L.selectAll("g.node").data(b,function(a){return a.id||(a.id=++D)}),e=d.enter().append("g").attr("class","node").style("cursor","pointer").attr("transform",function(b){return"translate("+(a.y||0)+","+(a.x0||0)+")"}).on("click",i).on("mouseover",o).on("mouseout",p).on("contextmenu",k);e.append("circle").attr("r",1e-6).style("stroke-width","1.5px").style("stroke",A.nodeStrokeColor).style("fill",A.nodeFillColor),A.enableInnerArcs&&e.append("path").attr("d",J).style("fill",A.nodeStrokeColor).style("fill-opacity",0),A.enableLabels&&e.append("text").attr("x",function(a){return a.isLeaf()?10:-10}).attr("dy",".35em").attr("text-anchor",function(a){return a.isLeaf()?"start":"end"}).text(A.getLabel).style("font","10px sans-serif").style("fill-opacity",1e-6);var f=d.transition().duration(x).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});f.select("circle").attr("r",g).style("fill-opacity",function(a){return a._children?1:0}).style("stroke",A.nodeStrokeColor).style("fill",A.nodeFillColor),A.enableLabels&&f.select("text").style("fill-opacity",1),A.enableInnerArcs&&f.select("path").duration(x).attr("d",J).style("fill-opacity",.8);var h=d.exit().transition().duration(x).attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).remove();h.select("circle").attr("r",1e-6),h.select("path").style("fill-opacity",1e-6),h.select("text").style("fill-opacity",1e-6);var j=L.selectAll("path.link").data(c,function(a){return a.target.id});j.enter().insert("path","g").attr("class","link").style("fill","none").style("stroke-opacity","0.5").style("stroke-linecap","round").style("stroke",A.linkStrokeColor).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x0||0,y:a.y0||0};return H({source:c,target:c})}),j.transition().duration(x).attr("d",H).style("stroke",A.linkStrokeColor).style("stroke-width",function(a){return a.source.selected?I(a.target.data.count)+"px":"4px"}),j.exit().transition().duration(x).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x,y:a.y};return H({source:c,target:c})}).remove(),b.forEach(function(a){var b=[a.x,a.y];a.x0=b[0],a.y0=b[1]})}function g(a){return a.selected?I(a.data.count)/2:2}function i(a){A.enableExpandOnClick&&(d3.event.defaultPrevented||(d3.event.shiftKey?a.expandAll():a.children?a.collapse():a.expand(),f(a),n(a)))}function k(a){A.enableRightClick&&m(a)}function m(a){if(a===B&&a!==E)return void m(E);B=a,E.setSelected(!1),a.setSelected(!0),I.domain([0,a.data.count]),a.expand(),null!==d3.event&&d3.event.preventDefault(),f(a),n(a)}function n(a){var b=K.scale(),c=-a.y0,d=-a.x0;c=c*b+A.width/4,d=d*b+A.height/2,L.transition().duration(x).attr("transform","translate("+c+","+d+")scale("+b+")"),K.scale(b),K.translate([c,d])}function o(a,b){A.enableTooltips&&(G.html(A.getTooltip(a)).style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px"),C=setTimeout(function(){G.style("visibility","visible")},1e3))}function p(a,b){A.enableTooltips&&(clearTimeout(C),G.style("visibility","hidden"))}function q(a){return a.selected?a._children?a.color||"#aaa":"#fff":"#aaa"}function r(a){return a.selected?a.color||"#aaa":"#aaa"}function s(a){return a.source.selected?a.target.color:"#aaa"}function t(a){return"<h3 class='tip-title'>"+A.getTooltipTitle(a)+"</h3><p>"+A.getTooltipText(a)+"</p>"}var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v={},w={top:5,right:5,bottom:5,left:5},x=750,y=d3.scale.category10(),z={height:300,width:600,nodeDistance:180,levelsToExpand:2,minNodeSize:2,maxNodeSize:105,countAccessor:function(a){return a.data.count},colors:function(a){return y(a.name)},nodeFillColor:q,nodeStrokeColor:r,linkStrokeColor:s,enableInnerArcs:!0,enableExpandOnClick:!0,enableRightClick:!0,enableLabels:!0,getLabel:function(a){return a.name},enableTooltips:!0,getTooltip:t,getTooltipTitle:j.default.getTooltipTitle,getTooltipText:j.default.getTooltipText},A=void 0,B=void 0,C=void 0,D=0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0,K=void 0,L=void 0;return v.reset=function(){K.scale(1),m(E)},function(){A=h({},z,u),l.default.settings=A,A.width=A.width-w.right-w.left,A.height=A.height-w.top-w.bottom,A.enableTooltips&&c(),A.enableInnerArcs&&d(),F=d3.layout.tree().nodeSize([2,10]).separation(function(a,b){var c=g(a)+g(b),d=c/2+4;return a.parent===b.parent?d:d+4}),H=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),I=d3.scale.linear().range([A.minNodeSize,A.maxNodeSize]),K=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",function(){L.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}),L=d3.select(a).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("viewBox","0 0 "+(A.width+w.right+w.left)+" "+(A.height+w.top+w.bottom)).attr("width",A.width+w.right+w.left).attr("height",A.height+w.top+w.bottom).call(K).append("g").attr("transform","translate("+w.left+","+w.top+")").append("g"),e(l.default.createNode(b))}(),v}function f(a,b){return this.each(function(){var c=$(this),d=c.data("vis.treeview"),f=$.extend({},c.data(),"object"===(void 0===b?"undefined":g(b))&&b);d||c.data("vis.treeview",d=new e(this,a,f)),"string"==typeof b&&d[b]()})}Object.defineProperty(b,"__esModule",{value:!0});var g="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(a){return void 0===a?"undefined":_typeof2(a)}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":void 0===a?"undefined":_typeof2(a)},h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};b.default=e;var i=c(2),j=d(i),k=c(3),l=d(k);$.fn.treeview=f,$.fn.treeview.Constructor=e},function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a)}return d(a,null,[{key:"stringHash",value:function(a){return a.split("").reduce(function(a,b){var c=(a<<5)-a+b.charCodeAt(0);return c&c},0)}},{key:"getReadableColorFor",value:function(b){var c="#000";try{c=a.brightness(d3.rgb(b))<125?"#eee":"#000"}catch(a){}return c}},{key:"brightness",value:function(a){return.299*a.r+.587*a.g+.114*a.b}},{key:"getTooltipTitle",value:function(a){return a.name}},{key:"getTooltipText",value:function(a){return a.data.count+" hits"}}]),a}();b.default=e},function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":_typeof2(b))&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":_typeof2(b)));a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(4),i=function(a){return a&&a.__esModule?a:{default:a}}(h),j=function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.settings=b.settings,c.setCount(),c}return f(b,a),g(b,[{key:"setCount",value:function(){this.settings.countAccessor(this)?this.data.count=this.settings.countAccessor(this):this.children?this.data.count=this.children.reduce(function(a,b){return a+b.data.count},0):this.data.count=0}},{key:"setSelected",value:function(a){this.setRecursiveProperty("selected",a)}},{key:"collapseAll",value:function(){this.children&&0===this.children.length&&(this.children=null),this.children&&(this._children=this.children,this._children.forEach(function(a){a.collapseAll()}),this.children=null)}},{key:"collapse",value:function(){this.children&&(this._children=this.children,this.children=null)}},{key:"expandAll",value:function(){this.expand(100)}},{key:"expand",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.settings.levelsToExpand;a>0&&(this._children&&(this.children=this._children,this._children=null),this.children&&this.children.forEach(function(b){b.expand(a-1)}))}}],[{key:"new",value:function(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"createNode",value:function(a){return i.default.createNode(a,b.new)}}]),b}(i.default);b.default=j},function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,a),this.data={},d(this,b)}return e(a,[{key:"setRecursiveProperty",value:function(a,b){this[a]=b,this.children?this.children.forEach(function(c){c.setRecursiveProperty(a,b)}):this._children&&this._children.forEach(function(c){c.setRecursiveProperty(a,b)})}},{key:"isLeaf",value:function(){return!this.children&&!this._children||this.children&&0===this.children.length||this._children&&0===this._children.length}},{key:"getHeight",value:function(){return void 0===this._height&&(this.isLeaf()?this._height=0:this._height=d3.max(this.children,function(a){return a.getHeight()})+1),this._height}},{key:"getDepth",value:function(){return void 0===this._depth&&(void 0===this.parent?this._depth=0:this._depth=this.parent.getDepth()+1),this._depth}}],[{key:"new",value:function(){return new a(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"createNode",value:function(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.new;return b.children&&(b.children=b.children.map(function(b){return a.createNode(b,c)})),c.call(null,b)}}]),a}();b.default=f},function(a,b,c){function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){function c(){C=d3.select("body").append("div").attr("id",a.id+"-tooltip").attr("class","tip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background-color","white").style("padding","2px").style("border","1px solid #dddddd").style("border-radius","3px;")}function d(){var b=v.className;$(a).addClass(b),$("<style>").prop("type","text/css").html("\n                    ."+b+" {\n                        font-family: Roboto,'Helvetica Neue',Helvetica,Arial,sans-serif;\n                    }\n                    ."+b+" .node {\n                        font-size: 9px;\n                        line-height: 10px;\n                        overflow: hidden;\n                        position: absolute;\n                        text-indent: 2px;\n                        text-align: center;\n                        text-overflow: ellipsis;\n                        cursor: pointer;\n                    }\n                    ."+b+" .node:hover {\n                        outline: 1px solid white;\n                    }\n                    ."+b+" .breadcrumbs {\n                        font-size: 11px;\n                        line-height: 20px;\n                        padding-left: 5px;\n                        font-weight: bold;\n                        color: white;\n                        box-sizing: border-box;\n                    }\n                    .full-screen ."+b+" .breadcrumbs {\n                        width: 100% !important;\n                    }\n                    ."+b+" .crumb {\n                        cursor: pointer;\n                    }\n                    ."+b+" .crumb .link:hover {\n                        text-decoration: underline;\n                    }\n                    ."+b+' .breadcrumbs .crumb + .crumb::before {\n                        content: " > ";\n                        cursor: default;\n                    }\n                ').appendTo("head")}function e(b){$(a).empty(),z=d3.layout.treemap().size([v.width+1,v.height+1]).padding([v.labelHeight,0,0,0]).value(v.countAccessor),D=d3.scale.linear().domain([0,v.levels]).range([v.colorRoot,v.colorLeaf]).interpolate(d3.interpolateLab),A=d3.select(a).append("div").attr("class","breadcrumbs").style("position","relative").style("width",v.width+"px").style("height","20px").style("background-color",v.colorBreadcrumbs),B=d3.select(a).append("div").style("position","relative").style("width",v.width+"px").style("height",v.height+"px").style("left",t.left+"px").style("top",t.top+"px")}function f(){for(var a=[],b=y;b;)a.push(b),b=b.parent;a.reverse(),A.html(""),A.selectAll(".crumb").data(a).enter().append("span").attr("class","crumb").attr("title",v.getBreadcrumbTooltip).html(function(a){return"<span class='link'>"+a.name+"</span>"}).on("click",function(a){g(a)})}function g(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];y=a,f();var c=B.selectAll(".node").data(z.nodes(a),function(a){return a.id||(a.id=++x)});c.enter().append("div").attr("class","node").style("background",function(a){return D(v.getLevel(a))}).style("color",function(a){return j.default.getReadableColorFor(D(v.getLevel(a)))}).style("left","0px").style("top","0px").style("width","0px").style("height","0px").text(v.getLabel).on("click",function(a){g(a)}).on("contextmenu",function(a){d3.event.preventDefault(),y.parent&&g(y.parent)}).on("mouseover",n).on("mousemove",p).on("mouseout",o),c.order().transition().call(k),c.exit().remove(),b&&v.rerootCallback&&v.rerootCallback.call(null,y)}function i(){B.selectAll(".node").data(z.nodes(b),function(a){return a.id}).order().transition().call(k)}function k(){this.style("left",function(a){return a.x+"px"}).style("top",function(a){return a.y+"px"}).style("width",function(a){return Math.max(0,a.dx-1)+"px"}).style("height",function(a){return Math.max(0,a.dy-1)+"px"})}function m(a,b){z=d3.layout.treemap().size([a+1,b+1]).padding([10,0,0,0]).value(v.countAccessor),i()}function n(a,b){v.enableTooltips&&C.html(v.getTooltip(a)).style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px").style("visibility","visible")}function o(a,b){v.enableTooltips&&C.style("visibility","hidden")}function p(a,b){v.enableTooltips&&C.style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px")}function q(a){return"<h3 class='tip-title'>"+v.getTooltipTitle(a)+"</h3><p>"+v.getTooltipText(a)+"</p>"}var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s={},t={top:0,right:0,bottom:0,left:0},u={height:300,width:600,className:"unipept-treemap",levels:void 0,getLevel:function(a){return a.getDepth()},countAccessor:function(a){return a.data.self_count},rerootCallback:void 0,getBreadcrumbTooltip:function(a){return a.name},colorRoot:"#104B7D",colorLeaf:"#fdffcc",colorBreadcrumbs:"#FF8F00",labelHeight:10,getLabel:function(a){return a.name},enableTooltips:!0,getTooltip:q,getTooltipTitle:j.default.getTooltipTitle,getTooltipText:j.default.getTooltipText},v=void 0,w=void 0,x=0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0;return s.reset=function(){g(w)},s.setFullScreen=function(a){setTimeout(function(){var b=[v.width,v.height],c=b[0],d=b[1];a&&(c=$(window).width(),d=$(window).height()-44),m(c,d)},1e3)},function(){v=h({},u,r),w=l.default.createNode(b),v.width=v.width-t.right-t.left,v.height=v.height-t.top-t.bottom,v.levels=v.levels||w.getHeight(),v.enableTooltips&&c(),d(),e(w),g(w,!1)}(),s}function f(a,b){return this.each(function(){var c=$(this),d=c.data("vis.treemap"),f=$.extend({},c.data(),"object"===(void 0===b?"undefined":g(b))&&b);d||c.data("vis.treemap",d=new e(this,a,f)),"string"==typeof b&&d[b]()})}Object.defineProperty(b,"__esModule",{value:!0});var g="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(a){return void 0===a?"undefined":_typeof2(a)}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":void 0===a?"undefined":_typeof2(a)},h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};b.default=e;var i=c(2),j=d(i),k=c(6),l=d(k);$.fn.treemap=f,$.fn.treemap.Constructor=e},function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":_typeof2(b))&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":_typeof2(b)));a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(4),i=function(a){return a&&a.__esModule?a:{default:a}}(h),j=function(a){function b(){return d(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return f(b,a),g(b,null,[{key:"new",value:function(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"createNode",value:function(a){return i.default.createNode(a,b.new)}}]),b}(i.default);b.default=j},function(a,b,c){function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){return this.each(function(){var c=$(this),d=c.data("vis.sunburst"),e=$.extend({},c.data(),"object"===(void 0===b?"undefined":h(b))&&b);d||c.data("vis.sunburst",d=new n(this,a,e)),"string"==typeof b&&d[b]()})}Object.defineProperty(b,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(a){return void 0===a?"undefined":_typeof2(a)}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":void 0===a?"undefined":_typeof2(a)},i=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=c(2),l=d(k),m=c(8),n=(d(m),function(){function a(b,c){var d=this,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};f(this,a),this.element=b,this.data=c,this.settings=i({},a.DEFAULTS,e),this.settings.width=this.settings.width-a.MARGIN.right-a.MARGIN.left,this.settings.height=this.settings.height-a.MARGIN.top-a.MARGIN.bottom,this.colorCounter=-1,this.data.children=this.addEmptyChildren(this.data.children,this.settings.countAccessor.call(null,this.data)),this.settings.enableTooltips&&this.initTooltip(),this.initCSS(),this.redraw(),setTimeout(function(){return d.reset()},1e3)}return j(a,[{key:"initTooltip",value:function(){this.tooltip=d3.select("body").append("div").attr("id",this.element.id+"-tooltip").attr("class","tip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background-color","white").style("padding","2px").style("border","1px solid #dddddd").style("border-radius","3px;")}},{key:"initCSS",value:function(){var a=this.settings.className;$(this.element).addClass(a),$("<style>").prop("type","text/css").html("\n."+a+" {\n    font-family: Roboto,'Helvetica Neue',Helvetica,Arial,sans-serif;\n    width: "+(this.settings.width+this.settings.breadcrumbWidth)+"px;\n}\n."+a+" .sunburst-breadcrumbs {\n    width: 176px;\n    float: right;\n    margin-top: 10px;\n    padding-left: 5px;\n}\n."+a+" .sunburst-breadcrumbs ul {\n    padding-left: 0;\n    list-style: none;\n}\n."+a+" .sunburst-breadcrumbs .crumb {\n    margin-bottom: 5px;\n    cursor: pointer;\n}\n."+a+" .sunburst-breadcrumbs .crumb svg {\n    float: left;\n    margin-right: 3px;\n}\n."+a+" .sunburst-breadcrumbs .crumb p {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    margin: 0;\n    font-size: 14px;\n}\n."+a+" .sunburst-breadcrumbs .crumb .percentage {\n    font-size: 11px;\n}").appendTo("head")}},{key:"addEmptyChildren",value:function(a,b){for(var c=0;c<a.length;c++)void 0!==a[c].children&&(a[c].children=this.addEmptyChildren(a[c].children,this.settings.countAccessor.call(null,a[c])));return a.length>0&&0!==b&&void 0!==b&&a.push({id:-1,name:"empty",data:{count:b,self_count:b}}),a}},{key:"redraw",value:function(){var b=this;$(this.element).empty(),this.breadcrumbs=d3.select(this.element).append("div").attr("id",this.element.id+"-breadcrumbs").attr("class","sunburst-breadcrumbs").append("ul"),this.x=d3.scale.linear().range([0,2*Math.PI]),this.y=d3.scale.linear().domain([0,1]).range([0,this.settings.radius]),this.currentMaxLevel=4;var c=d3.select(this.element).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("viewBox","0 0 "+(this.settings.width+a.MARGIN.right+a.MARGIN.left)+" "+(this.settings.height+a.MARGIN.top+a.MARGIN.bottom)).attr("width",this.settings.width+a.MARGIN.right+a.MARGIN.left).attr("height",this.settings.height+a.MARGIN.top+a.MARGIN.bottom).attr("overflow","hidden").style("font-family","'Helvetica Neue', Helvetica, Arial, sans-serif");c.append("style").attr("type","text/css").html(".hidden{ visibility: hidden;}"),c=c.append("g").attr("transform","translate("+this.settings.radius+","+this.settings.radius+")");var d=d3.layout.partition().sort(null).value(this.settings.countAccessor);this.arc=d3.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,b.x(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,b.x(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,a.y?b.y(a.y):a.y)}).outerRadius(function(a){return Math.max(0,b.y(a.y+a.dy))+1});var e=d.nodes(this.data);this.path=c.selectAll("path").data(e),this.path.enter().append("path").attr("class","arc").attr("id",function(a,b){return"path-"+b}).attr("d",this.arc).attr("fill-rule","evenodd").style("fill",function(a){return b.colour(a,b)}).on("click",function(a){a.depth<b.currentMaxLevel&&b.click(a)}).on("mouseover",function(a,c){return b.tooltipIn(a,c)}).on("mousemove",function(a,c){return b.tooltipMove(a,c)}).on("mouseout",function(a,c){return b.tooltipOut(a,c)}),this.text=c.selectAll("text").data(e);var f=this;this.text.enter().append("text").style("fill",function(a){return l.default.getReadableColorFor(b.colour(a,b))}).style("fill-opacity",0).style("font-family","font-family: Helvetica, 'Super Sans', sans-serif").style("pointer-events","none").attr("dy",".2em").text(this.settings.getLabel).style("font-size",function(a){return Math.floor(Math.min(f.settings.radius/f.settings.levels/this.getComputedTextLength()*10+1,12))+"px"})}},{key:"arcTween",value:function(b,c){var d=Math.min(a.maxY(b),b.y+c.settings.levels*b.dy),e=d3.interpolate(c.x.domain(),[b.x,b.x+b.dx]),f=d3.interpolate(c.y.domain(),[b.y,d]),g=d3.interpolate(c.y.range(),[b.y?20:0,c.settings.radius]);return function(a){return function(b){return c.x.domain(e(b)),c.y.domain(f(b)).range(g(b)),c.arc(a)}}}},{key:"setBreadcrumbs",value:function(a){for(var b=this,c=[],d=a;d;)c.push(d),d=d.parent;c.reverse().shift();var e=d3.svg.arc().innerRadius(0).outerRadius(15).startAngle(0).endAngle(function(a){return 2*Math.PI*a.data.count/a.parent.data.count}),f=this.breadcrumbs.selectAll(".crumb").data(c);f.enter().append("li").on("click",function(a){b.click(a.parent)}).attr("class","crumb").style("opacity","0").attr("title",function(a){return"["+a.data.rank+"] "+a.name}).html(function(a){return"\n<p class='name'>"+a.name+"</p>\n<p class='percentage'>"+Math.round(100*a.data.count/a.parent.data.count)+"% of "+a.parent.name+"</p>"}).insert("svg",":first-child").attr("width",30).attr("height",30).append("path").attr("d",e).attr("transform","translate(15, 15)").attr("fill",function(a){return b.colour(a,b)}),f.transition().duration(this.settings.duration).style("opacity","1"),f.exit().transition().duration(this.settings.duration).style("opacity","0").remove()}},{key:"click",value:function(b){var c=this;if("empty"!==b.name){this.setBreadcrumbs(b),this.settings.rerootCallback&&this.settings.rerootCallback.call(null,b),this.currentMaxLevel=b.depth+this.settings.levels,this.path.transition().duration(this.settings.duration).attrTween("d",this.arcTween(b,this)).attr("class",function(a){return a.depth>=c.currentMaxLevel?"arc toHide":"arc"}).attr("fill-opacity",function(a){return a.depth>=c.currentMaxLevel?.2:1});var d=this;this.text.style("visibility",function(c){return a.isParentOf(b,c,d.currentMaxLevel)?null:d3.select(this).style("visibility")}).transition().duration(this.settings.duration).attrTween("text-anchor",function(a){return function(){return d.x(a.x+a.dx/2)>Math.PI?"end":"start"}}).attrTween("dx",function(a){return function(){return d.x(a.x+a.dx/2)>Math.PI?"-4px":"4px"}}).attrTween("transform",function(a){return function(){var b=180*d.x(a.x+a.dx/2)/Math.PI-90;return"rotate("+b+")translate("+d.y(a.y)+")rotate("+(b>90?-180:0)+")"}}).style("fill-opacity",function(c){return a.isParentOf(b,c,d.currentMaxLevel)?1:1e-6}).each("end",function(c){d3.select(this).style("visibility",a.isParentOf(b,c,d.currentMaxLevel)?null:"hidden")})}}},{key:"colour",value:function(a,b){if("empty"===a.name)return"white";if(b.settings.useFixedColors)return b.settings.fixedColors[Math.abs(l.default.stringHash(a.name+" "+a.data.rank))%b.settings.fixedColors.length];if(a.children){var c=a.children.map(function(a){return b.colour(a,b)}),d=d3.hsl(c[0]),e=d3.hsl(c[1]);return 1===a.children.length||"empty"===a.children[1].name?d3.hsl(d.h,d.s,.98*d.l):d3.hsl((d.h+e.h)/2,(d.s+e.s)/2,(d.l+e.l)/2)}return a.color||(a.color=b.getColor()),a.color}},{key:"getColor",value:function(){return this.colorCounter=(this.colorCounter+1)%this.settings.colors.length,this.settings.colors[this.colorCounter]}},{key:"tooltipIn",value:function(a,b){this.settings.enableTooltips&&a.depth<this.currentMaxLevel&&"empty"!==a.name&&this.tooltip.html(this.settings.getTooltip(a)).style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px").style("visibility","visible")}},{key:"tooltipOut",value:function(a,b){this.settings.enableTooltips&&this.tooltip.style("visibility","hidden")}},{key:"tooltipMove",value:function(a,b){this.settings.enableTooltips&&this.tooltip.style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px")}},{key:"getTooltip",value:function(a){return"<h3 class='tip-title'>"+this.settings.getTooltipTitle(a)+"</h3><p>"+this.settings.getTooltipText(a)+"</p>"}},{key:"reset",value:function(){this.click(this.data)}},{key:"redrawColors",value:function(){var a=this;d3.selectAll(".crumb path").transition().style("fill",function(b){return a.colour(b,a)}),this.path.transition().style("fill",function(b){return a.colour(b,a)}),this.text.transition().style("fill",function(b){return l.default.getReadableColorFor(a.colour(b,a))})}},{key:"setFullScreen",value:function(a){setTimeout(function(){var b=740;a&&(b=Math.min($(window).height()-44,$(window).width()-250)),$(this.element).children("svg").attr("width",b).attr("height",b)},1e3)}}],[{key:"isParentOf",value:function(b,c,d){return!(c.depth>=d)&&(b===c||!!b.children&&b.children.some(function(b){return a.isParentOf(b,c,d)}))}},{key:"maxY",value:function(b){return b.children?Math.max.apply(Math,e(b.children.map(a.maxY))):b.y+b.dy}},{key:"MARGIN",get:function(){return{top:0,right:0,bottom:0,left:0}}},{key:"COLORS",get:function(){return["#f9f0ab","#e8e596","#f0e2a3","#ede487","#efd580","#f1cb82","#f1c298","#e8b598","#d5dda1","#c9d2b5","#aec1ad","#a7b8a8","#b49a3d","#b28647","#a97d32","#b68334","#d6a680","#dfad70","#a2765d","#9f6652","#b9763f","#bf6e5d","#af643c","#9b4c3f","#72659d","#8a6e9e","#8f5c85","#934b8b","#9d4e87","#92538c","#8b6397","#716084","#2e6093","#3a5988","#4a5072","#393e64","#aaa1cc","#e0b5c9","#e098b0","#ee82a2","#ef91ac","#eda994","#eeb798","#ecc099","#f6d5aa","#f0d48a","#efd95f","#eee469","#dbdc7f","#dfd961","#ebe378","#f5e351"]}},{key:"FIXED_COLORS",get:function(){return["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5","#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6","#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"]}},{key:"DEFAULTS",get:function(){return{height:600,width:600,breadcrumbWidth:200,radius:300,className:"unipept-sunburst",levels:4,getLevel:function(a){return a.getDepth()},duration:1e3,colors:a.COLORS,fixedColors:a.FIXED_COLORS,useFixedColors:!1,countAccessor:function(a){return a.data.self_count},rerootCallback:void 0,getLabel:function(a){return"empty"===a.name?"":a.name},enableTooltips:!0,getTooltip:this.getTooltip,getTooltipTitle:l.default.getTooltipTitle,getTooltipText:l.default.getTooltipText}}}]),a}())
;b.default=n,$.fn.sunburst=g,$.fn.sunburst.Constructor=n},function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":_typeof2(b))&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":_typeof2(b)));a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(4),i=function(a){return a&&a.__esModule?a:{default:a}}(h),j=function(a){function b(){return d(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return f(b,a),g(b,null,[{key:"new",value:function(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"createNode",value:function(a){return i.default.createNode(a,b.new)}}]),b}(i.default);b.default=j}]);