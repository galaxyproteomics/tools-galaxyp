<tool id="rna_abbased_data" name="Expression from RNAseq/Ab-based data (Human Protein Atlas)" version="0.1.0">
<description>
</description>
<requirements>
</requirements>
<stdio>
  <exit_code range="1:" />
</stdio>
<command><![CDATA[

  #if $inputtype.filetype == "copy_paste": 
  
    Rscript --vanilla $__tool_directory__/get_data_HPA_v2.R --inputtype copypaste --input '$inputtype.genelist' --header FALSE --proteinatlas $__tool_directory__/proteinatlas.csv --column c1 --select '$options.hpaparams' --output '$output'  

  #else 
  
    Rscript --vanilla $__tool_directory__/get_data_HPA_v2.R --inputtype tabfile --input '$inputtype.genelist' --header '$inputtype.header' --proteinatlas $__tool_directory__/proteinatlas.csv --column '$inputtype.column' --select '$options.hpaparams' --output '$output'  

  #end if
   

]]></command>

<inputs>
  <conditional name="inputtype">
    <param name="filetype" type="select" label="Select your type of input file"> 
      <option value="file_all">Input file containing your identifiers</option>
      <option value="copy_paste">Copy/paste your list of IDs</option> 
    </param>
    <when value="copy_paste">
      <param name="genelist" type="text" label="Enter a list of identifiers"/>
    </when>
    <when value="file_all">
      <param name="genelist" type="data" format="txt,tabular" label="Choose a multiple-columns file" help="This file must imperatively have 1 column filled with IDs consistent with the database that will be used. Please use the MappingIDs component if this is not the case."/>
      <param name="column" type="text" label="Please specify the column where you would like to apply the comparison (e.g : Enter c1)" value="c1"/> 
      <param name="header" type="select" label="Does your file have a header?" multiple="false" optional="false"> 
 		      <option value="TRUE" selected="true">Yes</option>
          <option value="FALSE" selected="false">No</option>
      </param>
    </when>
  </conditional>
  <section name="options" title="RNAseq/Ab-based data expression options" expanded="True">   
      <param name="hpaparams" type="select" label="Choose the expression from RNAseq/ab-based data you would like to add to your input" multiple="True" display="checkboxes"> 
          <option value="Gene" selected="true">Gene name</option>
          <option value="Gene.description" selected="false">Gene description</option>
          <option value="Evidence">Evidence (at protein level, at transcript level or no evidence)</option>
          <option value="Antibody">Antibody reference</option>
          <option value="RNA.tissue.category">RNA tissue category</option>
 		  <option value="Reliability..IH.">IH detection level</option>
          <option value="Reliability..IF.">IF detection level</option>
          <option value="Subcellular.location">Subcellular location</option>
          <option value="RNA.TS.TPM">RNA tissue specificity abundance in 'Transcript Per Million'</option>
          <option value="TPM.max.in.non.specific">RNA non-specific tissue abundance in 'Transcript Per Million'</option>
    </param>
  </section>

</inputs>


<outputs>
  <data name="output" format="tabular" label="abc"/>
</outputs>

<tests>
  <test>
    <conditional name="inputtype">
      <param name="filetype " value="file_all"/>
      <param name="genelist" value="mitochondrion_enzymes_Nextprot.txt"/>
      <param name="column" value="c1"/>
      <param name="header" value="TRUE"/>
    </conditional>
    <section name="options">
      <param name="hpaparams" value="Gene,Gene.description,Reliability..IH.,Subcellular.location,TPM.max.in.non.specific"/>
    </section>
    <output name="output" file="output_expression_rnaseq_abbased_data.tab"/>
  </test>
</tests>

<help><![CDATA[

This tool filters an input **tabular** file according to different databases.

**Input**

Input can be a file containing multiple fields but with **at least one column of Ensembl gene IDs** or a list of Ensembl gene ids. If your input file contains other kind of IDs, please refer to the MappingIDs component to create a column of Ensembl gene IDs.  

**Databases**

The input file will be filtered using information from different sources : 

- HPA normal tissue : will filter the input according to the data contained in the Human Protein Atlas webservice. Pertinent information, such as tissular location, will be added for each gene to your input file.  

- HPA cancer tissue :  will filter the input according to the data contained in the Human Protein Atlas webservice for cancer. Pertinent information, such as tumor type, will be added for each gene to your input file.  

**Parameters**

For HPA normal tissue :

- tissue category : categories based on RNA-Seq data to estimate the transcript abundance of each protein-coding gene in tissues. For more information, please refer to http://www.proteinatlas.org/about/assays+annotation#rna .

- level of detection IF : level of detection of the protein associated to the coding gene tissues based on immunofluorescency. For more information, please refer to http://www.proteinatlas.org/about/assays+annotation#if .

- level of detection IH :  level of detection of the protein associated to the coding gene tissues based on immunohistochemistry. For more information, please refer to http://www.proteinatlas.org/about/assays+annotation#if .

For HPA cancer tissue : 

- tumors : which tumors are associated with your protein-coding genes according to the Human Protein Atlas.


**Outputs**

The output will be a tabular file. The initial columns will be kept, but lines can be deleted due to the filtering process. Additional columns will be added according to which data you chose to filter your input with.  


**Data sources**

The data for HPA normal tissue was retrieved from the Human Protein Atlas downloadable data repository (http://www.proteinatlas.org/download/proteinatlas.tab.gz).

The data for HPA cancer was retrieved from the Human Protein Atlas downloadable data repository (http://www.proteinatlas.org/download/cancer.csv.zip).
]]></help>

<citations>
</citations>

</tool>
