<tool id="proteomics_moff" name="A modest Feature Finder" version="0.1">
    <description>to extract MS1 intensities from Thermo raw file (moFF)</description>
    <requirements>
        <requirement type="package" version="1.11.0">numpy</requirement>
        <requirement type="package" version="0.18.1">pandas</requirement>
        <requirement type="package" version="0.17.1">scipy</requirement>
        <requirement type="package" version="0.17.1">scikit-learn</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" level="fatal" description="Error occurred. Please check Tool Standard Error" />
        <exit_code range=":-1" level="fatal" description="Error occurred. Please check Tool Standard Error" />
    </stdio>
    <version_command>
    <![CDATA[

    ]]>
    </version_command>
    <command>
    <![CDATA[
        export TXIC_PATH=$__tool_directory__/
        &&
        mkdir ./raws &&
        #for $counter,$filename in enumerate($raw_repo):
            ln -s '$filename' './raws/$filename.display_name' &&
        #end for

        ln -s '$input' ./${input.display_name} &&

        python $__tool_directory__/moff.py
            --input './${input.display_name}'
            --tol $tol
            --rt_w $rt_w
            --rt_p $rt_p
            --rt_p_match $rt_p_match
            --raw_repo ./raws
            --output_folder ./out
        &&
        mv ./out/*.txt '$output_table'
        &&
        cat ./out/*.log

    ]]>
    </command>
    <inputs>
        <param argument="--input" type="data" format="tabular" label="Tabluar file from the PeptideShaker output"
            help="Specify the input file with the MS2 peptides/features"/>

        <param argument="--raw_repo" type="data" multiple="True" format="raw" label="RAW files"
            help=""/>

        <param argument="--tol" type="float" value="" label="Tolerance parameter"
            help="Specify the tolerance parameter in ppm." />

        <param argument="--rt_w" type="float" value="3.0" label="Retention time window"
            help="Specify rt window for xic in minutes." />

        <param argument="--rt_p" type="float" value="0.1" label="Time window for the peak"
            help="Specify the time windows for the peak in minutes." />

        <param argument="--rt_p_match" type="float" value="0.4" label="Time window for the matched peak"
            help="Specify the time windows for the matched peak in minutes." />

    </inputs>
    <outputs>
        <data format="tabular" name="output_table" />
    </outputs>
    <tests>
        <test>
            <param name="input" value="20080311_CPTAC6_07_6A005.txt"/>
            <param name="raw_repo" value="20080311_CPTAC6_07_6A005.RAW"/>
            <param name="tol" value="10.0"/>
            <output name="output_table" ftype="tabular" file="moff_result01.tabular"/>
        </test>
        <!--test>
            <param name="inputSequences" value="sample.fa"/>
            <param name="flavourType" value="mafft-nwns"/>
            <param name="outputFormat" value="- -clustalout"/>
            <output name="outputAlignment" ftype="clustal" file="mafft_nwns_result.aln"/>
        </test-->
    </tests>
    <help>
    <![CDATA[
**What it does**

    ]]>
    </help>
    <citations>
        <!--citation type="doi">10.1093/molbev/mst010</citation-->
    </citations>
</tool>
