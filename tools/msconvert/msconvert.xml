<tool id="msconvert" name="msconvert" version="0.3.0">
  <description>Convert and/or filter mass spectrometry files</description>

  <macros>
    <import>msconvert_macros.xml</import>
  </macros>

  <requirements>
    <requirement type="package" version="3.0.9992">proteowizard</requirement>
  </requirements>

  <expand macro="msconvertCommand" />

  <inputs> 
    <param format="mzml,mzxml,mz5,mgf,ms2" name="input" type="data" label="Input unrefined MS data" />

    <expand macro="msconvertInputParameters" />
  </inputs>

  <expand macro="msconvertOutput" />

  <tests>
    <test>
      <param name="input" value="small.mzML" />
      <param name="output_type" value="mzML" />
      <param name="pick_peaks" value="true" />
      <param name="pick_peaks_algorithm" value="cwt" />
      <param name="pick_peaks_ms_levels" value="1-" />
      <output name="output" file="small-peakpicking-cwt-allMS.mzML" />
    </test>

    <!-- this data file only has profile MS1, so the result is the same -->
    <test>
      <param name="input" value="small.mzML" />
      <param name="output_type" value="mzML" />
      <param name="pick_peaks" value="true" />
      <param name="pick_peaks_algorithm" value="cwt" />
      <param name="pick_peaks_ms_levels" value="1" />
      <output name="output" file="small-peakpicking-cwt-allMS.mzML" /> 
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mz5" />
      <param name="mz_encoding" value="64" />
      <param name="intensity_encoding" value="64" />
      <output name="output" file="small-zlib-64.mz5" compare="sim_size" delta="100" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzXML" />
      <param name="mz_encoding" value="32" />
      <param name="intensity_encoding" value="32" />
      <output name="output" file="small-zlib-32.mzXML" />
    </test>
    <!-- TODO: how to test gzipped output?
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzXML" />
      <param name="mz_encoding" value="32" />
      <param name="intensity_encoding" value="32" />
      <param name="binary_compression" value="false" />
      <param name="gzip_compression" value="true" />
      <output name="output" file="small-off-32.mzXML.gz" compare="sim_size" delta="100" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="mz_encoding" value="32" />
      <param name="intensity_encoding" value="32" />
      <param name="binary_compression" value="false" />
      <param name="gzip_compression" value="true" />
      <output name="output" file="small-off-32.mzML.gz" compare="sim_size" delta="100" />
    </test>-->

    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-numpressLP.mzML" />
    </test>

    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressLinearSlof" />
      <output name="output" file="small-numpressLS.mzML" />
    </test>

    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressLinear" />
      <output name="output" file="small-numpressL.mzML" />
    </test>

    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressPic" />
      <output name="output" file="small-numpressP.mzML" />
    </test>

    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressSlof" />
      <output name="output" file="small-numpressS.mzML" />
    </test>

    <test>
      <param name="input" value="Rpal_01.mz5" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressLinearPic" />
      <param name="use_mzrefinement" value="true" />
      <param name="input_ident" value="Rpal_01.pepXML.gz" />
      <param name="thresholdScore" value="mvh" />
      <param name="thresholdValue" value="40-" />
      <output name="output" file="Rpal_01-mzRefinement.mzML" compare="sim_size" delta="0" />
      <output name="output.refinement" file="Rpal_01.pepXML.mzRefinement.tsv" />
    </test>
    
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressLinearPic" />
      <param name="charge_state_calculation_method" value="predictor" />
      <param name="predictor_overrideExistingCharge" value="true" />
      <param name="minMultipleCharge" value="2" />
      <param name="maxMultipleCharge" value="5" />
      <param name="singleChargeFractionTIC" value="0.95" />
      <param name="maxKnownCharge" value="8" />
      <output name="output" file="small-chargeStatePredictor.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressLinearPic" />
      <param name="charge_state_calculation_method" value="turbocharger" />
      <param name="minCharge" value="1" />
      <param name="maxCharge" value="5" />
      <param name="precursorsBefore" value="1" />
      <param name="precursorsAfter" value="1" />
      <param name="halfIsoWidth" value="1.5" />
      <param name="defaultMinCharge" value="1" />
      <param name="defaultMaxCharge" value="5" />
      <output name="output" file="small-turbocharger.mzML" />
    </test>
    <test>
      <param name="input" value="D100930_yeast_SCX10S_rak_ft8E_pc_01.mz5" />
      <param name="output_type" value="mzML" />
      <param name="do_etd_filtering" value="true" />
      <param name="remove_precursor" value="true" />
      <param name="remove_charge_reduced" value="true" />
      <param name="remove_neutral_loss" value="false" />
      <param name="blanket_removal" value="false" />
      <param name="matching_tolerance" value="50" />
      <param name="matching_tolerance_units" value="ppm" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="D100930_yeast_SCX10S_rak_ft8E_pc_01-etdfilter.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="thresholds_0|threshold_type" value="count" />
      <param name="thresholds_0|value" value="100" />
      <param name="thresholds_0|orientation" value="most-intense" />
      <param name="thresholds_1|threshold_type" value="absolute" />
      <param name="thresholds_1|value" value="1" />
      <param name="thresholds_1|orientation" value="most-intense" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-threshold.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="do_mzwindow_filter" value="true" />
      <param name="mz_window_from" value="420" />
      <param name="mz_window_to" value="840" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-mzWindow.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="denoise" value="true" />
      <param name="num_peaks" value="10" />
      <param name="window_width" value="40" />
      <param name="relax" value="false" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-denoise.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="ms2deisotope" value="true" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-deisotope.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="activation" value="CID" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-activation.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="indices_0|from" value="2" />
      <param name="indices_0|to" value="4" />
      <param name="indices_1|from" value="10" />
      <param name="indices_1|to" value="10" />
      <param name="indices_2|from" value="13" />
      <param name="indices_2|to" value="15" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-index-filter.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="strip_it" value="true" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-strip-it.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="do_ms_level_filter" value="true" />
      <param name="ms_level_from" value="2" />
      <param name="ms_level_to" value="2" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-ms-level-filter.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="polarity" value="positive" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-polarity-filter.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="analyzer" value="IT" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-analyzer-filter.mzML" />
    </test>
    <test>
      <param name="input" value="small-peakpicking-cwt-allMS.mzML" />
      <param name="output_type" value="mzML" />
      <param name="scan_numbers_0|from" value="3" />
      <param name="scan_numbers_0|to" value="5" />
      <param name="scan_numbers_1|from" value="11" />
      <param name="scan_numbers_1|to" value="11" />
      <param name="scan_numbers_2|from" value="14" />
      <param name="scan_numbers_2|to" value="16" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-index-filter.mzML" /> <!-- the scan numbers here produce the same output as the index test above -->
    </test>
    <!--<test>
      <param name="input" value="small.mzML" />
      <param name="output_type" value="mzML" />
      <param name="binary_compression" value="numpressLinearPic" />
      <output name="output" file="small-deisotope-poisson.mzML" />
    </test>-->
  </tests>
  <help>
**What it does**

Allows interconversion within various mass spectrometry peak list formats. Additional options such as filtering and/or precursor recalculation are available.

You can view the original documentation here_.

.. _here: http://proteowizard.sourceforge.net/tools/msconvert.html
  </help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/btn323</citation>
        <citation type="bibtex">@misc{toolsGalaxyP, author = {Chilton, J, Chambers MC, et al.}, title = {Galaxy Proteomics Tools}, publisher = {GitHub}, journal = {GitHub repository},
                                      year = {2015}, url = {https://github.com/galaxyproteomics/tools-galaxyp}}</citation> <!-- TODO: fix substitution of commit ", commit = {$sha1$}" -->
    </citations>
</tool>
