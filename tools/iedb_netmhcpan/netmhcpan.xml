<tool id="iedb_netmhcpan" name="NetMHCPan" version="4.1+galaxy1" profile="25.1">
    <description>MHC Binding prediction</description>
    <macros>
        <import>netmhcpan_alleles_macros.xml</import>
        <import>shared_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="required_files"/>

    <command detect_errors="exit_code"><![CDATA[
        #import re
        python '${__tool_directory__}/nextgen_iedb_api.py'
        --tool-group=mhci
        #for $method in $methods:
          --method=$method
        #end for

        #if $alleles.allelesrc == 'history':
          -A '$alleles.allele_file'
        #else:
          -A '$entered_alleles'
        #end if
        #if $split_conditional.input_peptide_length == 'split'
          -l $split_conditional.length_start,$split_conditional.length_end
        #end if

        #if $sequence.seqsrc == 'fasta':
          -i '$sequence.seq_fasta'
        #else if $sequence.seqsrc == 'tabular':
          -i '$sequence.seq_tsv'
          -c #echo int(str($sequence.pep_col)) - 1
        #else:
          -i '$entered_seqs' -c 0
        #end if
        -o '$output'
    ]]></command>
    <configfiles>
        <expand macro="configfiles" />
    </configfiles>
    <inputs>
        <param name="methods" type="select" multiple="true" label="Prediction Method">
            <option value="netmhcpan_el" selected="true">netmhcpan_el</option>
            <option value="netmhcpan_ba">netmhcpan_ba</option>
        </param>
        <expand macro="inputs" hla_examples="HLA-A*03:01 HLA-B*07:02"/>
    </inputs>
    <outputs>
        <data name="output" format="tabular" label="IEDB NetMHCPan ${methods}"/>
    </outputs>
    <tests>
        <!-- test1 -->
        <test>
            <param name="alleles|allelesrc" value="entry"/>
            <param name="alleles|allele_text" value="HLA-A*01:01 HLA-A*03:01"/>
            <param name="methods" value="netmhcpan_ba,netmhcpan_el"/>
            <param name="split_conditional|input_peptide_length" value="split"/>
            <param name="sequence|seqsrc" value="entry"/>
            <param name="sequence|seq_text" value="SLYNTVATLYCVHQRIDV"/>
            <output name="output" file="outputs/netmhcpan_output_1.tsv"/>
        </test>
        <!-- test2 -->
        <test>
            <param name="alleles|allelesrc" value="history"/>
            <param name="alleles|allele_file" value="netmhcpan_alleles.txt"/>
            <param name="split_conditional|input_peptide_length" value="split"/>
            <param name="sequence|seqsrc" value="tabular"/>
            <param name="sequence|seq_tsv" value="seqs.tsv"/>
            <param name="sequence|pep_col" value="3"/>
            <output name="output" file="outputs/netmhcpan_output_2.tsv"/>
        </test>
        <!-- test3 -->
        <test>
            <param name="alleles|allelesrc" value="history"/>
            <param name="alleles|allele_file" value="netmhcpan_alleles.txt"/>
            <param name="split_conditional|input_peptide_length" value="split"/>
            <param name="split_conditional|length_start" value="8"/>
            <param name="split_conditional|length_end" value="14"/>
            <param name="sequence|seqsrc" value="fasta"/>
            <param name="sequence|seq_fasta" value="seqs.fa"/>
            <output name="output" file="outputs/netmhcpan_output_3.tsv"/>
        </test>
    </tests>
    <help><![CDATA[
The NetMHCpan-4.1 server predicts binding of peptides to any MHC molecule of known sequence using artificial neural networks (ANNs).

This tool uses the "Next-Generation IEDB Tools" API to submit NetMHCpan-4.1 jobs and retrieve results.
IEDB is a free resource, funded by a contract from the National Institute of Allergy and Infectious Diseases.
    ]]></help>
    <citations>
        <expand macro="citations" />
    </citations>
</tool>
