<tool id="psm_zscore" name="PSM z-score" version="0.1.0">
    <description>Add a zscore column to a PSM report</description>
    <requirements>
        <requirement type="package" version="3.2.1">R</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        echo "Global FDR: ";
        Rscript '${__tool_directory__}/PSM_Z_Score.R'
        z_cutoff=$z_cutoff 
        ppm_tolerance=$ppm_tolerance 
        psm_report='"$psm_report"' 
        output_psm_report='"$zscored_psm_report"' | awk '{print \$2}'
    ]]></command>
    <inputs>
        <param name="psm_report" type="data" format="tabular" label="PSM report"/>
        <param name="z_cutoff" type="float" value="2" min="0.1" max="10" label="Z-value cutoof"/>
        <param name="ppm_tolerance" type="integer" value="10" label="ppm tolerance" 
         help="The ppm tolerance value used when generating the PSM report"/>
    </inputs>
    <outputs>
        <data name="zscored_psm_report" format="tabular" />
    </outputs>
    <tests>
        <test>
            <param name="psm_report" ftype="tabular" value="PSM_report_in.tsv"/>
            <param name="z_cutoff" value="2"/>
            <param name="ppm_tolerance" value="0"/>
            <output name="zscored_psm_report">
                <assert_contents>
                    <has_text_matching expression="1\tNP_001419\t.*\t\d+\.\d+"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
