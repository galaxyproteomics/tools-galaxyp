<macros>
    <token name='@TOOL_VERSION@'>0.1.0</token>
	<token name='@GALAXY_VERSION@'>0</token>

    <token name='@BIOCONTAINER_VERSION@'>biocontainers/i2nca:0.3.12_cv1</token>


    <xml name='m2aia_preprocessing'>
        <conditional name='m2aia'>
            <param name='use_m2aia_preproc' label='Use the m2aia signal preprocessing?' type='select'>
                <option value='FALSE' >No</option>
                <option value='TRUE' >Yes</option>
            </param>

            <when value='TRUE'>

            <param name='bsl' label='m2aia Baseline Correction' type='select' help='Select a strategy for Baseline correction.'>
                <option value='None' selected='true'>No Correction</option>
                <option value='Median' >Median Baseline Correction</option>
                <option value='TopHat' >Top Hat Baseline Correction</option>
            </param>
            
            <param name='bsl_hws' label='Choose the half-windowsize for Baseline correction:' type='integer'
                               value='50'
                               help='Choose the half window size in which baseline correction should be applied'/>
            

            <param name='smo' label='m2aia Spectral Smoothing' type='select' help='Select a strategy for Spectral Smoothing.'>
                <option value='None' selected='true'>No Smoothing</option>
                <option value='Gaussian' >Gaussian Smoothing</option>
                <option value='SavitzkyGolay' >Savitzky Golay Smoothing</option>
            </param>

            <param name='smo_hws' label='Choose the half window size for Smoothing:' type='integer'
                               value='50'
                               help='Choose the half window size in which baseline correction should be applied'/>

            <param name='nor' label='m2aia Normalization' type='select' help='Select a strategy for Intensity Normalization.'>
                    <option value='None' selected='true'>No Normalization</option>
                    <option value='TIC' >TIC Normalization</option>
                    <option value='RMS' >RMS Normalization</option>
                    <option value='Sum' >Sum Normalization</option>
                    <option value='Mean' >Mean Normalization</option>
                    <option value='Max' >Max Normalization</option>
                </param>

            <param name='itr' label='m2aia Intensity transformation' type='select' help='Select a strategy for Intensity Transformation.'>
                <option value='None' selected='true'>No Transformation</option>
                <option value='Log2' >log2 Transformation</option>
                <option value='Log10' >log10 Transformation</option>
                <option value='SquareRoot' >Square Root Transformation</option>
            </param>
            </when>
            <when value='FALSE'>
            </when>


    </conditional>
    </xml>

    <token name='@M2AIA_PARAMETERS@'>'--nor' '${m2aia.nor}' '--itr' '${m2aia.itr}' '--bsl_hws' '${m2aia.bsl_hws}' '--bsl' '${m2aia.bsl}' '--smo_hws' '${m2aia.smo_hws}' '--smo' '${m2aia.smo}'</token>

    <token name='@I2NCA_DESCRIPTION@'><![CDATA[
        i2nca is a Python package that creates high-level workflows for the preprocesing of mass spectrometry imaging datasets.
        `More information on i2nca can be found at the github page: <https://github.com/cKNUSPeR/i2nca>`_
    ]]></token>
    <token name='@MSIDATA_INPUT_DESCRIPTION@'><![CDATA[
        
    MSI data: Please provide the MSI data as imzml Composite. For this, use the 'Composite option' for the data upload and provide the following two files:

        - .imzml file: An xml file containing the metadata of the dataset.
        - .ibd file: a binary data file containing the raw spectral inforation.
    ]]></token>

    <token name='@M2AIA_INPUT_DESCRIPTION@'><![CDATA[
    

    **Other preprocessing options**


    m2aia preprocessing: The underlying parser pacakge m2aia allows additional preprocessing steps:

        - Spectral Smoothing: Smooths the  ms spectral curve. Requires a strategy and a half-window size (given in spectral data points).
        - Normalization: Normalizes the intensity of the ms spectra on a per-pixel basis. 
        - Intensity Transformation: Transforms the intensity of the ms spectra.
        - Baseline Reduction: Corrects the baseline of the ms spectra. Requires a strategy and a half-window size (given in spectral data points).
    ]]></token>

    <xml name='pp_infile'>
        <param name='infile' value='' ftype='imzml'>
            <composite_data value='pp.imzML'/>
            <composite_data value='pp.ibd'/>
        </param>
    </xml>

    <xml name='cp_infile'>
        <param name='infile' value='' ftype='imzml'>
            <composite_data value='cp.imzML'/>
            <composite_data value='cp.ibd'/>
        </param>
    </xml>

    <xml name='pc_infile'>
        <param name='infile' value='' ftype='imzml'>
            <composite_data value='pc.imzML'/>
            <composite_data value='pc.ibd'/>
        </param>
    </xml>

    <xml name='cc_infile'>
        <param name='infile' value='' ftype='imzml'>
            <composite_data value='cc.imzML'/>
            <composite_data value='cc.ibd'/>
        </param>
    </xml>

    <xml name='jpc_infile'>
        <param name='infile' value='' ftype='imzml'>
            <composite_data value='combined_pc.imzML'/>
            <composite_data value='combined_pc.ibd'/>
        </param>
    </xml>

    <xml name='citation_m2aia'>
        <citation type="bibtex">
            @article{10.1093/gigascience/giab049,
                author = {Cordes, Jonas and Enzlein, Thomas and Marsching, Christian and Hinze, Marven and Engelhardt, Sandy and Hopf, Carsten and Wolf, Ivo},
                title = '{M2aiaâ€”Interactive, fast, and memory-efficient analysis of 2D and 3D multi-modal mass spectrometry imaging data}',
                journal = {GigaScience},
                volume = {10},
                number = {7},
                year = {2021},
                month = {07},
                issn = {2047-217X},
                doi = {10.1093/gigascience/giab049},
                url = {https://doi.org/10.1093/gigascience/giab049}
            }
        </citation>
    </xml>

    <xml name='citation_i2nca'>
        <citation type="bibtex">
            @misc{githubi2nca,
            author = {Jannik Witte},
            title = {i2nca},
            publisher = {GitHub},
            journal = {Github repository},
            url = {https://github.com/cKNUSPeR/i2nca}
        }
        </citation>
    </xml>
    
</macros>
