<macros>
    <token name="@VERSION@">0.9.0</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@VERSION@">encyclopedia</requirement>
            <yield/>
        </requirements>
    </xml>
    <xml name="citations">
        <citations>
            <yield />
        </citations>
    </xml>
    <token name="@CMD_IMPORTS@">
    #import re
    #set $i_name = None
    #set $f_name = None
    #set $l_name = None
    #set $t_name = None
    </token>

    <xml name="scan_input">
        <param argument="-i" type="data" format="imzml,mzml" label="Spectrum file, .mzml or .dia"/> 
    </xml>
    <token name="@LINK_SCAN_INPUT@"><![CDATA[
    #set $i_name = $i.display_name
    ln -s '$i' '$i_name' &&
    ]]></token>
    <token name="@SCAN_INPUT@">
    -i '$i_name'
    </token>

    <xml name="scan_inputs">
        <param argument="-i" type="data" format="imzml,mzml" multiple="true" label="Spectrum file, .mzml or .dia"/> 
    </xml>
    <token name="@LINK_SCAN_INPUTS@"><![CDATA[
    #set $inputs_dir = 'inputs'
    mkdir -p $inputs_dir &&
    #for $sf in $i
      #set $i_name = $sf.display_name
      ln -s '$sf' '${inputs_dir}/${i_name}' &&
    #end for
    ]]></token>
    <token name="@SCAN_INPUTS@">
    -i '$inputs_dir'
    </token>

    <xml name="fasta_input">
        <param argument="-f" type="data" format="fasta" label="Background protein fasta database"/> 
    </xml>
    <token name="@LINK_FASTA_INPUT@"><![CDATA[
    #set $f_name = $f.display_name
    ln -s '$f' '$f_name' &&
    ]]></token>
    <token name="@FASTA_INPUT@">
    -f '$f_name'
    </token>

    <xml name="target_fasta">
        <param argument="-t" type="data" format="fasta" label="target FASTA file" optional="true"/> 
        <param argument="-tp" type="boolean" truevalue="true" falsevalue="false" checked="false" label="target FASTA file contains peptides"/>
    </xml>
    <token name="@LINK_TARGET_FASTA@"><![CDATA[
    #if $t
    #set $t_name = $t.display_name
    ln -s '$t' '$t_name' &&
    #else
    #set $t_name = None
    #end if
    ]]></token>
    <token name="@TARGET_FASTA@">
    #if $t_name
    -t '$t_name'
    -tp $tp
    #end if
    </token>

    <xml name="lib_input">
        <param argument="-l" type="data" format="elib,dlib" label="Library: Chromatagram .ELIB or Spectrum .DLIB"/> 
    </xml>
    <token name="@LINK_LIB_INPUT@"><![CDATA[
    #set $l_name = $l.display_name
    cp '$l' $l_name &&
    ]]></token>
    <token name="@LIB_INPUT@">
    -l '$l_name'
    </token>

    <xml name="common_options">
        <section name="acquisition" expanded="true" title="Acquisition Options">
        <param argument="-numberOfExtraDecoyLibrariesSearched" type="float" value="0.0" min="0.0" max="1.0" label="numberOfExtraDecoyLibrariesSearched"/>
        <param argument="-acquisition" type="select" label="Data Acquization Type">
            <option value="Non-Overlapping DIA">Non-Overlapping DIA</option>
            <option value="Overlapping DIA">Overlapping DIA</option>
        </param>
        <param argument="-enzyme" type="select" label="Digestion Enzyme">
             <option value="Trypsin">Trypsin</option>
             <option value="Trypsin/p">Trypsin/p</option>
             <option value="Lys-C">Lys-C</option>
             <option value="Lys-N">Lys-N</option>
             <option value="Arg-C">Arg-C</option>
             <option value="Glu-C">Glu-C</option>
             <option value="Chymotrypsin">Chymotrypsin</option>
             <option value="Pepsin A">Pepsin A</option>
             <option value="Elastase">Elastase</option>
             <option value="Thermolysin">Thermolysin</option>
             <option value="No Enzyme">No Enzyme</option>
        </param>
        <param argument="-frag" type="select" label="Fragmentation">
            <option value="CID">CID/HCD (B/Y)</option>
            <option value="HCD">HCD (Y-Only)</option>
            <option value="ETD">ETD (C/Z/Z+1)</option>
        </param>
        </section>
    </xml>
    <token name="@COMMON_OPTIONS@">
    -numberOfExtraDecoyLibrariesSearched $acquisition.numberOfExtraDecoyLibrariesSearched
    -acquisition '$acquisition.acquisition'
    -enzyme '$acquisition.enzyme'
    -frag '$acquisition.frag'
    </token>

    <xml name="mass_tolerance">
        <section name="tolerance" expanded="true" title="Tolerance Options">
        <conditional name="precursor_tolerance">
            <param argument="-ptolunits" type="select" label="Precursor Mass Tolerance">
                <option value="PPM">PPM</option>
                <option value="AMU">AMU</option>
                <option value="Resolution">Resolution</option>
            </param>
            <when value="PPM">
                <param argument="-ptol" type="float" value="10" min="1.0" max="200.0" label="Precursor Mass Tolerance (PPM)"/>
            </when>
            <when value="AMU">
                <param argument="-ptol" type="float" value=".4" min="1.0" max="1.0" label="Precursor Mass Tolerance (AMU)"/>
            </when>
            <when value="Resolution">
                <param argument="-ptol" type="integer" value="15000" min="5000" max="300000" label="Precursor Mass Tolerance (Resolution)"/>
            </when>
        </conditional>
        <conditional name="fragment_tolerance">
            <param argument="-ftolunits" type="select" label="Fragment Mass Tolerance">
                <option value="PPM">PPM</option>
                <option value="AMU">AMU</option>
                <option value="Resolution">Resolution</option>
            </param>
            <when value="PPM">
                <param argument="-ftol" type="float" value="10" min="1.0" max="200.0" label="Fragment Mass Tolerance (PPM)"/>
            </when>
            <when value="AMU">
                <param argument="-ftol" type="float" value=".4" min="1.0" max="1.0" label="Fragment Mass Tolerance (AMU)"/>
            </when>
            <when value="Resolution">
                <param argument="-ftol" type="integer" value="15000" min="5000" max="300000" label="Fragment Mass Tolerance (Resolution)"/>
            </when>
        </conditional>
        <yield/>
        </section>
    </xml>
    <token name="@MASS_TOLERANCE@">
    -ptolunits $tolerance.precursor_tolerance.ptolunits
    -ptol $tolerance.precursor_tolerance.ptol
    -ftolunits $tolerance.fragment_tolerance.ftolunits
    -ftol $tolerance.fragment_tolerance.ftol
    </token>

    <xml name="mass_library_tolerance">
        <expand macro="mass_tolerance">
        <conditional name="library_tolerance">
            <param argument="-ltolunits" type="select" label="Library Mass Tolerance">
                <option value="PPM">PPM</option>
                <option value="AMU">AMU</option>
                <option value="Resolution">Resolution</option>
            </param>
            <when value="PPM">
                <param argument="-ltol" type="float" value="10" min="1.0" max="200.0" label="Library Mass Tolerance (PPM)"/>
            </when>
            <when value="AMU">
                <param argument="-ltol" type="float" value=".4" min="1.0" max="1.0" label="Library Mass Tolerance (AMU)"/>
            </when>
            <when value="Resolution">
                <param argument="-ltol" type="integer" value="15000" min="5000" max="300000" label="Library Mass Tolerance (Resolution)"/>
            </when>
        </conditional>
        </expand>
    </xml>
    <token name="@MASS_LIBRARY_TOLERANCE@">
    @MASS_TOLERANCE@
    -ltolunits $tolerance.library_tolerance.ltolunits
    -ltol $tolerance.library_tolerance.ltol
    </token>

    <xml name="percolator_options">
        <section name="percolator" expanded="false" title="Pecolator Options">
            <param argument="-percolatorVersionNumber" type="integer" value="3" min="2" max="3" label="percolatorVersionNumber"/>
            <param argument="-percolatorProteinThreshold" type="float" value="0.01" label="percolatorProteinThreshold"/>
            <param argument="-percolatorThreshold" type="float" value="0.01" label="percolatorThreshold"/>
        </section>
    </xml>
    <token name="@PERCOLATOR_OPTIONS@">
    #if str($percolator.percolatorVersionNumber)
        -percolatorVersionNumber $percolator.percolatorVersionNumber
    #end if
    #if str($percolator.percolatorProteinThreshold)
        -percolatorProteinThreshold $percolator.percolatorProteinThreshold
    #end if
    #if str($percolator.percolatorThreshold)
        -percolatorThreshold $percolator.percolatorThreshold
    #end if
    </token>

    <xml name="peak_options">
        <section name="peak" expanded="false" title="Peak Options">
            <param argument="-numberOfQuantitativePeaks" type="integer" value="5" min="1" max="100" label="Number of Quantitative Peaks"/>
            <param argument="-minNumOfQuantitativePeaks" type="integer" value="3" min="0" max="100" label="Minimum Number of Quantitative Peaks"/>
            <param argument="-minQuantitativeIonNumber" type="integer" value="3" min="0" max="100" label="Minimum Number of Quantitative Ions"/>
            <param argument="-minIntensity" type="float" value="-1.0" label="minIntensity"/>
            <param argument="-expectedPeakWidth" type="float" value="25.0" min="1" max="100.0" label="Expected Peak Width"/>
            <param argument="-filterPeaklists" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Filter Peak Lists"/>
        </section>
    </xml>
    <token name="@PEAK_OPTIONS@">
    #if str($peak.numberOfQuantitativePeaks)
        -numberOfQuantitativePeaks $peak.numberOfQuantitativePeaks
    #end if
    #if str($peak.minNumOfQuantitativePeaks)
        -minNumOfQuantitativePeaks $peak.minNumOfQuantitativePeaks
    #end if
    #if str($peak.minQuantitativeIonNumber)
        -minQuantitativeIonNumber $peak.minQuantitativeIonNumber
    #end if
    #if str($peak.minIntensity)
        -minIntensity $peak.minIntensity
    #end if
    #if str($peak.expectedPeakWidth)
        -expectedPeakWidth $peak.expectedPeakWidth
    #end if
    -filterPeaklists $peak.filterPeaklists
    </token>

    <xml name="window_options">
        <section name="window" expanded="false" title="Window Options">
        <param argument="-foffset" type="integer" value="0" label="fragmentOffsetPPM"/>
        <param argument="-poffset" type="integer" value="0" label="Precursor Offset PPM" help="-poffset"/>
        <param argument="-precursorIsolationMargin" type="integer" value="0" label="precursorIsolationMargin"/>
        <param argument="-precursorWindowSize" type="integer" value="-1" label="precursorWindowSize"/>
        <param argument="-rtWindowInMin" type="float" value="-1.0" label="rtWindowInMin"/>
        <param argument="-scoringBreadthType" type="select" label="scoringBreadthType">
            <option value="window">Across entire window</option>
            <option value="recal20">Recalibrated (20% gradient)</option>
            <option value="recal">Recalibrated (peak width only)</option>
            <option value="uncal20">Uncalibrated (20% gradient)</option>
            <option value="uncal">Uncalibrated (peak width only)</option>
        </param>
        </section>
    </xml>
    <token name="@WINDOW_OPTIONS@">
        -foffset $window.foffset
        -poffset $window.poffset
        -precursorIsolationMargin $window.precursorIsolationMargin
        -precursorWindowSize $window.precursorWindowSize
        -rtWindowInMin $window.rtWindowInMin
        -scoringBreadthType $window.scoringBreadthType
    </token>

    <xml name="modification_options">
        <section name="modifications" expanded="false" title="Modification Options">
        <param argument="-fixed" type="select" label="Fixed Modification">
            <option value="C=57.0214635">C=57.0214635</option>
        </param>
        <!--
        <param argument="-localizationModification" type="select" optional="true" label="localizationModification">
        </param>
        -->
        <param argument="-verifyModificationIons" type="boolean" truevalue="true" falsevalue="false" checked="true" label="verifyModificationIons"/>
        </section>
    </xml>
    <token name="@MODIFICATION_OPTIONS@">
        -verifyModificationIons $modifications.verifyModificationIons
    </token>

    <xml name="search_options">
        <section name="search" expanded="false" title="Search Options">
        <param argument="-minCharge" type="integer" value="2" min="1" max="10" label="minCharge" optional="true"/>
        <param argument="-maxCharge" type="integer" value="3" min="1" max="10" label="maxCharge" optional="true"/>
        <param argument="-minLength" type="integer" value="5" min="1" max="100" label="minLength" optional="true"/>
        <param argument="-maxLength" type="integer" value="100" min="10" max="200" label="maxLength" optional="true"/>
        <param argument="-minEluteTime" type="integer" value="12" min="1" max="69" label="minEluteTime" optional="true"/>
        <param argument="-maxMissedCleavage" type="integer" value="1" min="0" max="5" label="maxMissedCleavage" optional="true"/>
        <param argument="-minQuantitativeIonNumber" type="integer" value="3" min="1" max="10" label="minQuantitativeIonNumber" optional="true"/>
        <param argument="-minNumOfQuantitativePeaks" type="integer" value="3" min="1" max="10" label="minNumOfQuantitativePeaks" optional="true"/>
        <param argument="-numberOfQuantitativePeaks" type="integer" value="3" min="1" max="10" label="numberOfQuantitativePeaks" optional="true"/>
        <param argument="-alpha" type="float" value="1.8" min="0.0" max="5.0" label="alpha"/>
        <param argument="-beta" type="float" value="0.4" min="0.0" max="5.0" label="beta"/>
        <param argument="-addDecoysToBackground" type="boolean" truevalue="true" falsevalue="false" checked="false" label="addDecoysToBackground"/>
        <param argument="-dontRunDecoys" type="boolean" truevalue="true" falsevalue="false" checked="false" label="dontRunDecoys"/>
        </section>
    </xml>
    <token name="@SEARCH_OPTIONS@">
        -minCharge $search.minCharge
        -maxCharge $search.maxCharge
        -minLength $search.minLength
        -maxLength $search.maxLength
        -minEluteTime $search.minEluteTime
        -maxMissedCleavage $search.maxMissedCleavage
        -minQuantitativeIonNumber $search.minQuantitativeIonNumber
        -minNumOfQuantitativePeaks $search.minNumOfQuantitativePeaks
        -numberOfQuantitativePeaks $search.numberOfQuantitativePeaks
        -alpha $search.alpha
        -beta $search.beta
        -addDecoysToBackground $search.addDecoysToBackground
        -dontRunDecoys $search.dontRunDecoys
    </token>
minNumOfQuantitativePeaks minQuantitativeIonNumber numberOfQuantitativePeaks numberOfReportedPeaksu
    <!--
	+acquisition                (default: overlapping dia)
	+addDecoysToBackground      (default: false)
	+alpha                      (default: 1.8)
	+beta                       (default: 0.4)
	+dontRunDecoys              (default: false)
	+enzyme                     (default: trypsin)
	+filterPeaklists            (default: false)
	+fixed                      (default: C=57.0214635)
	+foffset                    (default: 0)
	=frag                       (default: YONLY)
	+ftol                       (default: 10)
	+ftolunits                  (default: ppm)
	+maxCharge                  (default: 3)
	+maxLength                  (default: 100)
	+maxMissedCleavage          (default: 1)
	+minCharge                  (default: 2)
	+minEluteTime               (default: 12)
	+minIntensity               (default: -1.0)
	+minLength                  (default: 5)
	+minNumOfQuantitativePeaks  (default: 3)
	+minQuantitativeIonNumber   (default: 3)
	+numberOfQuantitativePeaks  (default: 5)
	-numberOfReportedPeaks      (default: 1)
	-numberOfThreadsUsed        (default: 12)
	+percolatorProteinThreshol  (default: 0.01)
	+percolatorThreshold        (default: 0.01)
	+percolatorVersionNumber    (default: 3)
	+poffset                    (default: 0)
	+precursorIsolationMargin   (default: 0)
	+precursorWindowSize        (default: -1)
	+ptol                       (default: 10)
	+ptolunits                  (default: ppm)
	-requireVariableMods        (default: false)
	-variable                   (default: -)
   --> 
    <xml name="libexport">
        <param argument="-a" type="boolean" truevalue="true" falsevalue="false" checked="true" label="align between files"/>
    </xml>
</macros>
<!--
e w t x l	param
+:+:+:+:+	i
+:+:+:+:+	l
+:+:+:+:+	f

+:+:+:+:+	t
-:+:-:+:-	tp
-:+:-:+:+	a

+:+:+:+:+	o

+:+:+:+:-	acquisition
-:+:-:+:-	addDecoysToBackground
-:+:-:+:-	alpha
-:+:-:+:-	beta
-:-:-:-:+	blib
-:+:-:+:-	dontRunDecoys
+:+:+:+:-	enzyme
+:-:+:-:-	expectedPeakWidth
+:+:+:+:-	filterPeaklists
+:+:+:+:+	fixed
+:+:+:+:+	foffset
+:+:+:+:-	frag
+:+:+:+:+	ftol
+:+:+:+:+	ftolunits
+:-:+:-:-	lftol
+:-:+:-:-	lftolunits
+:-:-:-:-	libexport
+:-:+:-:+	localizationModification
-:+:-:+:-	maxCharge
-:+:-:+:-	maxLength
-:+:-:+:-	maxMissedCleavage
-:+:-:+:-	minCharge
-:+:-:+:-	minEluteTime
+:+:+:+:-	minIntensity
-:+:-:+:-	minLength
+:+:+:+:+	minNumOfQuantitativePeaks
+:+:+:+:+	minQuantitativeIonNumber
+:-:+:-:+	numberOfExtraDecoyLibrariesSearched
+:+:+:+:+	numberOfQuantitativePeaks
-:+:-:+:-	numberOfReportedPeaks
-:+:-:+:-	numberOfThreadsUsed
-:-:-:-:+	percolatorLocation
-:+:-:+:-	percolatorProteinThreshol
+:-:+:-:+	percolatorProteinThreshold
+:+:+:+:+	percolatorThreshold
+:+:+:+:-	percolatorVersionNumber
-:-:-:-:+	phospho
+:+:+:+:-	poffset
+:+:+:+:-	precursorIsolationMargin
+:+:+:+:-	precursorWindowSize
+:+:+:+:-	ptol
+:+:+:+:-	ptolunits
-:+:-:+:-	requireVariableMods
+:-:+:-:-	rtWindowInMin
+:-:+:-:-	scoringBreadthType
-:+:-:+:-	variable
+:-:+:-:-	verifyModificationIons
-->
