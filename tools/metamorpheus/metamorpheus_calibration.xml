<tool id="metamorpheus_calibration" name="MetaMorpeus Calibration" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@" python_template_version="3.5">
    <description>identify peptides by their calibrate the m/z values of all peaks in the spectra</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
@PREPARE_INPUTS@
@MERGE_TOMLS@
metamorpheus
-t tasksettings.toml
## -s #echo ' '.join($spectrum_names)#
-s $inputs_dir
-d #echo ' '.join($database_names)#
-o output
    ]]></command>
    <configfiles>
        <configfile name="default_toml"><![CDATA[#slurp
@DEFAULT_CALIBRATION_TOML@
]]></configfile>
        <configfile name="user_toml">
@CALIBRATE_CONFIG@
@COMMON_CONFIG@
        </configfile>
        <configfile name="task_settings_toml">#slurp
        </configfile>
    </configfiles>
    <inputs>
        <expand macro="input_spectrums" multiple="true"/>
        <expand macro="input_databases"/>
        <expand macro="input_toml"/>
        <expand macro="calibrate_params"/>
        <expand macro="common_params"/>
    </inputs>
    <outputs>
        <expand macro="output_settings_toml"/>
        <data name="results" format="txt" label="${tool.name} on ${on_string} results.txt" from_work_dir="output/allresults.txt"/>
        <data name="prose" format="txt" label="${tool.name} on ${on_string} prose.txt" from_work_dir="output/Task1CalibrationTask/prose.txt"/>
        <expand macro="calibrated_outputs"/>
    </outputs>
    <tests>
        <test>
            <param name="spectrums" ftype="mzml" value="SmallCalibratible_Yeast.mzML"/>
            <param name="databases" ftype="fasta" value="SmallYeast.fasta"/>
            <output name="results">
                <assert_contents>
                    <has_text text="MS2 calibration datapoint count: 819" />
                    <has_text text="Engine type: CalibrationEngine" />
                </assert_contents>
            </output>
            <output_collection name="calibrated_scans" type="list">
                <element name="SmallCalibratible_Yeast-calib.mzML">
                    <assert_contents>
                        <has_text_matching expression="id=.SmallCalibratible_Yeast-calib" />
                        <has_text_matching expression="dataProcessing id=.mzLibProcessing" />
                    </assert_contents>
                </element>
            </output_collection>
 
        </test>
    </tests>
    <help><![CDATA[
@METAMORPHEUS_HELP@
    ]]></help>
    <expand macro="citations" />
</tool>
