<tool id="metamorpheus_g_ptm_d" name="MetaMorpeus G-PTM-D" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@" python_template_version="3.5">
    <description>Post-translational modification (PTM) discovery</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
@PREPARE_INPUTS@
@LN_CALIB_TOML@
@MERGE_TOMLS@
metamorpheus
-t tasksettings.toml
## -s #echo ' '.join($spectrum_names)#
-s $inputs_dir
-d #echo ' '.join($database_names)#
-o output
--mmsettings data
    ]]></command>
    <configfiles>
        <configfile name="default_toml"><![CDATA[#slurp
@DEFAULT_GPTMD_TOML@
]]></configfile>
        <configfile name="user_toml">
@GPTMD_CONFIG@
@COMMON_CONFIG@
        </configfile>
        <configfile name="task_settings_toml">#slurp
        </configfile>
    </configfiles>
    <inputs>
        <expand macro="input_spectrums" multiple="true" filetype="Calibrated Spectrum"/>
        <expand macro="calib_toml"/>
        <expand macro="input_databases"/>
        <expand macro="input_toml"/>
        <expand macro="common_params"/>
    </inputs>
    <outputs>
        <expand macro="output_settings_toml"/>
        <data name="results" format="txt" label="${tool.name} on ${on_string} results.txt" from_work_dir="output/allresults.txt"/>
        <data name="prose" format="txt" label="${tool.name} on ${on_string} prose.txt" from_work_dir="output/Task*GptmdTask/prose.txt"/>
        <data name="db_xml" format="uniprotxml" label="${tool.name} on ${on_string} ${databases[0].name.rsplit('.',1)[0]}GPTMD.xml" from_work_dir="output/Task*GptmdTask/*GPTMD.xml"/>
        <data name="psmtsv" format="tabular" label="${tool.name} on ${on_string} GPTMD_Candidates.psmtsv" from_work_dir="output/Task*GptmdTask/GPTMD_Candidates.psmtsv"/>
    </outputs>
    <tests>
        <test>
            <param name="spectrums" ftype="mzml" value="SmallCalibratible_Yeast-calib.mzML"/>
            <param name="calib_tomls" ftype="toml" value="SmallCalibratible_Yeast-calib.toml"/>
            <param name="databases" ftype="fasta" value="SmallYeast_uniprot.xml"/>
            <output name="results">
                <assert_contents>
                    <has_text text="Engine type: GptmdEngine" />
                </assert_contents>
            </output>
            <output name="db_xml">
                <assert_contents>
                    <has_text text="mzLibProteinDb" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
@METAMORPHEUS_HELP@
    ]]></help>
    <expand macro="citations" />
</tool>
