<tool id="metamorpheus_search" name="MetaMorpeus Database Search" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@" python_template_version="3.5">
    <description>identify peptides by their fragmentation spectra</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
@PREPARE_INPUTS@
@LN_CALIB_TOML@
@MERGE_TOMLS@
metamorpheus
-t tasksettings.toml
-s ${inputs_dir}
-d #echo ' '.join($database_names)#
-o output
--mmsettings data
    ]]></command>
    <configfiles>
        <configfile name="default_toml"><![CDATA[#slurp
@DEFAULT_SEARCH_TOML@
]]></configfile>
        <configfile name="user_toml">
@SEARCH_CONFIG@
@COMMON_CONFIG@
        </configfile>
        <configfile name="task_settings_toml">#slurp
        </configfile>
    </configfiles>
    <inputs>
        <expand macro="input_spectrums" multiple="true" filetype="Calibrated Spectrum"/>
        <expand macro="calib_toml"/>
        <expand macro="input_databases"/>
        <expand macro="input_toml"/>
        <expand macro="common_params"/>
        <expand macro="search_params"/>
    </inputs>
    <outputs>
        <expand macro="output_settings_toml"/>
        <data name="results" format="txt" label="${tool.name} on ${on_string} results.txt" from_work_dir="output/allresults.txt"/>
        <data name="prose" format="txt" label="${tool.name} on ${on_string} prose.txt" from_work_dir="output/Task*SearchTask/prose.txt"/>
        <data name="allpsms" format="tabular" label="${tool.name} on ${on_string} AllPSMs.psmtsv" from_work_dir="output/Task*SearchTask/AllPSMs.psmtsv"/>
        <data name="allpsms_percolator" format="tabular" label="${tool.name} on ${on_string} AllPSMs_FormattedForPercolator.tab" from_work_dir="output/Task*SearchTask/AllPSMs_FormattedForPercolator.tab"/>
        <data name="allpeptides" format="tabular" label="${tool.name} on ${on_string} AllPeptides.psmtsv" from_work_dir="output/Task*SearchTask/AllPeptides.psmtsv"/>
        <data name="allquantifiedpeaks" format="tabular" label="${tool.name} on ${on_string} AllQuantifiedPeaks.tsv" from_work_dir="output/Task*SearchTask/AllQuantifiedPeaks.tsv">
        </data>
        <data name="allquantifiedpeptides" format="tabular" label="${tool.name} on ${on_string} AllQuantifiedPeptides.tsv" from_work_dir="output/Task*SearchTask/AllQuantifiedPeptides.tsv">
        </data>
        <data name="allquantifiedprotein" format="tabular" label="${tool.name} on ${on_string} AllQuantifiedProteinGroups.tsv" from_work_dir="output/Task*SearchTask/AllQuantifiedProteinGroups.tsv">
        </data>
        <expand macro="search_collection_outputs"/>
    </outputs>
    <tests>
        <test>
            <param name="spectrums" ftype="mzml" value="SmallCalibratible_Yeast-calib.mzML"/>
            <param name="calib_tomls" ftype="toml" value="SmallCalibratible_Yeast-calib.toml"/>
            <param name="databases" ftype="fasta" value="SmallYeastGPTMD.xml"/>
            <output name="results">
                <assert_contents>
                    <has_text text="Engine type: ProteinScoringAndFdrEngine" />
                </assert_contents>
            </output>
            <output name="allpsms">
                <assert_contents>
                    <has_text text="KGNNTANATN[Common Artifact:Deamidation on N]SANTVQK" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
@METAMORPHEUS_HELP@
    ]]></help>
    <expand macro="citations" />
</tool>
