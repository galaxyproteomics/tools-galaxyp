<tool id="msslookup_spectra" name="Create lookup table with spectra" version="1.1">
    <description>for correlating quant and ID data</description>
    <requirements>
        <requirement type="package" version="2.5">msstitch</requirement>
    </requirements>  
    <command detect_errors="exit_code">
       <![CDATA[
       #for $displayname in $spectra.keys()
           ln -s '$spectra[$displayname]' '$displayname' &&
       #end for
       python $__tool_directory__/msslookup_spectra.py
           --infiles
           #for $displayname in $spectra.keys()
               '$displayname'
           #end for
           --setpatterns 
            #for $pool in $pools
                '${pool.set_identifier}'
            #end for
           --setnames
           #for $pool in $pools
               '${pool.set_name}'
           #end for
        &&
        mv mslookup_db.sqlite '$output'
        ]]>
    </command>
    <inputs>
        <param name="spectra" type="data_collection" format="mzml" label="Spectra in mzML" />
        <repeat name="pools" title="Biological sets">
            <param name="set_identifier" type="text" label="Filename part identifying biological set" help="Specify part of the input spectra filenames that are unique for each set, e.g set_A."/>
            <param name="set_name" type="text" label="Nice name for the set" help="e.g. Set #1, Patient 3" />
        </repeat>
    </inputs>
    <outputs>
        <data format="sqlite" name="output"/>
    </outputs>
    <tests>
        <test>
            <repeat name="pools">
                <param name="set_identifier" value="set1" />
                <param name="set_name" value="Set1" />
           </repeat> 
           <repeat name="pools"> 
               <param name="set_identifier" value="set2" />
               <param name="set_name" value="Set2" />
           </repeat>
           <param name="spectra">
                <collection type="list">
                    <element name="set1_spectra.mzml" value="spectra.mzml" />
                    <element name="set2_spectra.mzml" value="spectra.mzml" />
                </collection>
           </param>
           <output name="output" file="spectra.sql" compare="sim_size" />
        </test>
    </tests>
    <help>
        Store some information about the MS2 spectra in an SQLite database. Will later be used
        to reference identifications to spectra and output e.g. scan number, retention time 
        which MSGF+ does not use.
    </help>
</tool>
