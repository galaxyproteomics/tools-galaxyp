<tool id="msspercolator_merge" name="Merge Percolator" version="1.1">
    <description>fractions from a dataset collection into single XML file</description>
    <requirements>
        <requirement type="package" version="2.5">msstitch</requirement>
    </requirements>
    <command detect_errors="exit_code">
        msspercolator merge -o '$output' -i
        #if $fm.flattenormerge.value == "flatten"
            #for $key in $fm.input.keys()
                '$fm.input[$key]'
            #end for
            #else if $fm.flattenormerge.value == "merge"
            #for $percodset in $fm.pdata
                '$percodset.input'
            #end for
        #end if
    </command>
    
    <inputs>
        <conditional name="fm">
            <param name="flattenormerge" type="select" display="radio" label="Merge method">
                <option value="flatten">Flatten collection</option>
                <option value="merge">Merge multiple datasets</option>
            </param>
            <when value="flatten">
                <param name="input" type="data_collection" collection_type="list" format="percout" label="Percolator output" />
            </when>
            <when value="merge">
                <repeat name="pdata" title="Percolator datasets">
                    <param name="input" type="data" format="percout" label="Percolator output" />
                </repeat>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output" format="percout" />
    </outputs>
    <tests>
        <test>
            <param name="fm|flattenormerge" value="flatten" />
            <param name="fm|input">
                <collection type="list">
                    <element name="perco1" value="perco_split_target.xml" />
                    <element name="perco2" value="perco_split_decoy.xml" />
               </collection>
            </param>
            <output name="output" value="percolator.xml" compare="sim_size" />
        </test>
        <test>
            <param name="fm|flattenormerge" value="merge" />
            <repeat name="fm|pdata">
                <param name="input" value="perco_split_target.xml" />
            </repeat>
            <repeat name="fm|pdata">
                <param name="input" value="perco_split_decoy.xml" />
            </repeat>
            <output name="output" value="percolator.xml" compare="sim_size" />
        </test>
    </tests>
    <help>
        This tool merges multifile percolator output into one percolator output file
    </help>
    <citations>
        <citation type="doi">10.1038/nmeth1113</citation>
    </citations>
</tool>
