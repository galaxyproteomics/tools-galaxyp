<tool id="msslookup_quant" name="Create lookup table with quant data" version="1.0">
    <description>of openMS isobaric quant and Kronik MS1 quant</description>
    <requirements>
        <requirement type="package" version="2.2">msstitch</requirement>
    </requirements>  
    <command>
            <![CDATA[
            cp '$dbfile' spec_lookup.sql

	    #if $kronik.yesno.value == "yes"
	    &&
	    msslookup ms1quant -i --dbfile spec_lookup.sql
                #for $fn in $ms1.quantdata.keys()
                    '$ms1.quantdata[$fn]'
                #end for
                --spectra 
                #for $sfn in $spectra.keys()
                    '$spectra[$sfn]'
                #end for
	        --quanttype $ms1.quanttype
                --mztol $ms1.mztol
                --mztoltype $ms1.mztoltype
                --rttol $ms1.rttol
	    #end if

	    #if $consxml.yesno.value == "true"
	        &&
	        msslookup isoquant -i --dbfile spec_lookup.sql
                #for $fn in $consxml.quantdata.keys()
                    '$consxml.quantdata[$fn]'
                #end for
                --spectra 
                #for $sfn in $spectra.keys()
                    '$spectra[$sfn]'
                #end for
	    #end if 

	    &&
            mv spec_lookup.sql '$output'
            ]]>
    </command>
    <inputs>
      <param name="spectra" type="data_collection" format="mzml" label="Spectra in mzML" />
      <param name="dbfile" type="data" format="sqlite" label="Existing lookup table containing spectra" />
      <conditional name="consxml">
	      <param type="select" label="Store isobaric quant data?" display="radio" name="yesno">
		      <option value="yes">Yes</option>
		      <option value="no">No</option>
	     </param>
	     <when value="yes">
		     <param name="quantdata" type="data_collection" format="consensusxml" label="Quant data in consensusXML" /> 
	     </when> 
	     <when value="no" />
    </conditional>
    <conditional name="ms1">
	    <param type="select" display="radio" label="Store MS1 quant data?" name="yesno">
		    <option value="yes">Yes</option>
		    <option value="no">No</option>
	   </param>
	   <when value="yes">
		   <param name="quanttype" type="select" label="Quantification output type">
			   <option value="kronik" selected="true">Kronik</option>
		   </param>
		   <param name="quantdata" type="data_collection" format="kr" label="Quant data from kronik" />
		   <param name="rttol" type="float" label="Retention time lookup tolerance value in seconds" value="5" />
		   <param name="mztol" type="float" label="m/z lookup tolerance value" value="20" />
		   <param name="mztoltype" type="select" label="m/z lookup tolerance unit">
			   <option value="ppm">ppm</option>
			   <option value="Da">Da</option>
		  </param>
	  </when>
	  <when value="no" />
     </conditional>
     </inputs>
    <outputs>
        <data format="sqlite" name="output"/>
    </outputs>
    <tests>
	    <test>
		    <param name="spectra" value="spectra.mzml" />
		    <param name="dbfile" value="spectra.sql" />
		    <param name="consxml|yesno" value="yes" />
		    <param name="consxml|quantdata" value="quant.consxml" />
		    <param name="ms1|yesno" value="yes" />
		    <param name="ms1|quanttype" value="kronik" />
		    <param name="ms1|quantdata" value="quant.kr" />
		    <param name="ms1|rttol" value="6" />
		    <param name="ms1|mztol" value="20" />
		    <param name="ms1|mztoltype" value="ppm" />
		   <output name="output" value="quant.sql" />
	    </test>
    </tests>
    <help>
	    This stores quantification data from OpenMS Isobaric Analyzer tools in an SQLite lookup database
	    for later use in PSM quantification.
    </help>
</tool>
