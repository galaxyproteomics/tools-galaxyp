<tool id="create_protein_table" name="Create protein table" version="1.0">
    <description>from PSMs</description>
    <requirements>
        <requirement type="package" version="2.2">msstitch</requirement>
    </requirements>
    <command>
            <![CDATA[
	    msspeptable psm2pep -i '$psmtable' -o peptidetable.txt --scorecolpattern '$scorecol'
            #if $fncol
            --spectracol $fncol
            #end if
            #if $isoquant.yesno.value == "yes"
            --isobquantcolpattern $isoquant.isobpattern
            #end if
            #if $precurqcolpattern
            --ms1quantcolpattern '$precurqcolpattern'
            #end if
	    
	    #if $isoquant.yesno.value == "yes"
	    &&
	    mssprottable isoquant -i '$psmtable' -o isoquant.txt --protcol $isoquant.accessioncol --isobquantcolpattern "$isoquant.isobpattern"
	    &&
	    msspeptable isoquant -i peptidetable.txt -o peptide_isoquant.txt
	    --quantfile isoquant.txt --qaccpattern accession --isobquantcolpattern $isoquant.isobqcolpattern
	    &&
	    mv peptide_isoquant.txt peptidetable.txt
	    #end if

	    && mv peptidetable.txt '$output.txt'
            ]]>
    </command>
    <inputs>
	    <param name="psmtable" type="data" format="mzidtsv" label="PSM table" help="Must contain isobaric ratios and accession of protein/gene/peptide" />
	    <param name="fncol" type="integer" value="" label="Column number containing spectra file name" optional="true" />
	    <param name="scorecol" type="text" label="Regular expression pattern to identify score column" help="E.g. svm"/>
	   <param name="precurqcolpattern" type="text" label="Regular expression pattern to identify precursor quant columns" optional="true" help="E.g. area"/>
	    <conditional name="isoquant">
		    <param name="yesno" type="select" label="Use isobaric data?">
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
		    </param>
		    <when value="no" />
		    <when value="yes"> 
			    <param name="isobpattern" type="text" label="Pattern for isobaric quant columns in PSM table" help="Regex to find quant columns, e.g. tmt10plex, itraq8plex, plex"/>
			   <param name="accessioncol" type="integer" value="" label="Accession column number in PSM table containing the proteins, genes, peptides to quantify" />
		    </when>
	    </conditional>
    </inputs>
    
    <outputs>
        <data format="peptable" name="output"/>
    </outputs>
    <help>
	    Creates a peptide table from PSM table. It is optional to add 
	    isobaric quant, precursor quant, probabilities.
    </help>
</tool>
