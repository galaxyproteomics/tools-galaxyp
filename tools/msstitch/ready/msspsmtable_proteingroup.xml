<tool id="msspsmtable_proteingroup" name="Add protein groups to MSGF+ table">
    <requirements>
        <requirement type="package" version="2.2">msstitch</requirement>
    </requirements>
  
    <description>based on peptide, PSM count</description>
    
    <command>
	    cp '$lookup' psm_lookup.sql
	    &&
	    msslookup proteingroup -i '$input' --dbfile psm_lookup.sql
	    #if $proteincolumn.value 
	    --protcol $proteincolumn
	    #end if
	    &&
	    msspsmtable proteingroup -i '$input' --dbfile psm_lookup.sql -o '$psmoutput'
	    &&
	    mv psm_lookup.sql '$lookupoutput'
    </command>
    
    <inputs>
      <param name="input" type="data" format="mzidtsv" label="TSV of MSGF+ output" />
      <param name="proteincolumn" type="integer" optional="true" label="TSV protein column number" help="In case it is not the standard Protein column" />
      <param name="lookup" type="data" format="mslookupsql" label="Existing lookup containing PSMs" />
    </inputs>
    
    <outputs>
        <data format="mslookupsql" name="lookupoutput"/>
        <data format="mzidtsv" name="psmoutput"/>
    </outputs>

    <help>
	    This tool assigns protein groups to the PSM table. It uses mslookup to store protein-PSM relationships.
	    In short, groups are formed with one or more master protein which is comprised of a set of detected 
	    peptides that all the other group's proteins' detected peptides are subsets of.
	    Since the proteins can tie for master protein on the amount of peptides, the order of importance for determining
	    master proteins is: amount of peptides, amount of PSMs, protein score (summed MSGFScore of PSMs), 
	    protein evidence level (if Uniprot).
    </help>

</tool>
