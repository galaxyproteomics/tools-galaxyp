<tool id="msspercolator_merge" name="Merge Percolator">
    <requirements>
        <requirement type="package" version="2.2">msstitch</requirement>
    </requirements>
    <description>fractions from a dataset collection into single XML file</description>

    <command>msspercolator merge -o '$output' -i
            #if $fm.flattenormerge.value == "flatten"
	    #for $key in $fm.input.keys()
	    '$fm.input[$key]'
	    #end for
            #else if $fm.flattenormerge.value == "merge"
	    #for $percodset in $fm.pdata
	    '$percodset.input'
	    #end for
            #end if
    </command>
    
    <inputs>
        <conditional name="fm">
            <param name="flattenormerge" type="select" display="radio" label="Merge method">
                <option value="flatten">Flatten collection</option>
                <option value="merge">Merge multiple datasets</option>
            </param>
            <when value="flatten">
                <param name="input" type="data_collection" format="percout" label="Percolator output" />
            </when>
            <when value="merge">
                <repeat name="pdata" title="Percolator datasets">
                    <param name="input" type="data" format="percout" label="Percolator output" />
                </repeat>
            </when>
        </conditional>
    </inputs>
    
    <outputs>
        <data name="output" format="percout" />
    </outputs>
<stdio>
    <exit_code range="1:" level="fatal" description="msstitch exited with an error." />
</stdio>

  <help>
	  This tool merges multifile percolator output into one percolator output file
  </help>
</tool>
