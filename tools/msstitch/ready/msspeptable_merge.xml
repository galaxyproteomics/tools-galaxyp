<tool id="msspeptable_merge" name="Merge peptide tables">
    <requirements>
        <requirement type="package" version="2.2">msstitch</requirement>
    </requirements>
    <description>containing multiple biological sets</description>
    <command>
	    cp '$lookup' psmpg_lookup.sql
	    &&
	    msslookup peptides --dbfile psmpg_lookup.sql
	    --peptidecol $quanttype.featcol
			-i
                        #for $fn in $peptidetables.keys()
                        '$peptidetables[$fn]'
                        #end for
                        --filekeys
                        #for $spfn in $peptidetables.keys()
                        '$spfn'
                        #end for
                        #if $precurqcolpattern
                        --ms1quantcolpattern '$precurqcolpattern'
                        #end if
                        #if $nopsmcolpattern
                        --psmnrcolpattern '$nopsmcolpattern' 
                        #end if
                        #if $isobqcolpattern
                        --isobquantcolpattern '$isobqcolpattern'
                        #end if
                        #if $fdrpattern
                        --fdrcolpattern '$fdrpattern'
                        #end if
                        #if $peppattern
                        --pepcolpattern '$peppattern'
                        #end if
	    &&
	    peptable build -o '$peptideoutput' --dbfile psmpg_lookup.sql
            #if $centric.value == "gene"
            --genecentric
            #else if $centric.value == "plain"
            --noncentric
            #end if
            #if $isobqcolpattern
            --isobaric
            #end if
            #if $precurqcolpattern
            --precursor
            #end if
            #if $fdrpattern
            --fdr
            #end if
            #if $peppattern
            --pep
            #end if
	    &&
	    mv psmpg_lookup.sql '$lookupoutput'
	    <!-- FIXME add cross-table FDR here? -->
    </command>
    
    <inputs>
      <param name="lookup" type="data" format="mslookupsql" label="Lookup file containing PSM/spectra info" />
      <param name="peptidetables" type="data_collection" format="peptsv" label="Peptide tables"  />
      <param name="featcol" type="integer" value="1" min="1" label="Column number in which peptide sequences are" />
      <param name="centric" type="select" display="radio" label="Center data on">
          <option value="pg">protein groups</option>
          <option value="gene">genes</option>
          <option value="plain">non-centric</option>
      </param>
      <param name="precurqcolpattern" type="text" label="Regular expression pattern to identify precursor quant columns" optional="true" help="E.g. area"/>
      <param name="isobqcolpattern" type="text" label="Regular expression pattern to identify columns containing isobaric quantification data" optional="true" help="E.g. tmt10plex, plex" />
      <param name="nopsmcolpattern" type="text" label="Regular expression pattern to identify columns containing the amount of PSMs quantified" optional="true" help="E.g. quanted" />
      <param name="fdrpattern" type="text" label="Regular expression pattern to identify columns containing protein FDR" optional="true" help="E.g. q-value" />
      <param name="peppattern" type="text" label="Regular expression pattern to identify columns containing protein PEP" optional="true" help="E.g. PEP" />
    </inputs>
    
    <outputs>
        <data format="peptsv" name="peptideoutput"/>
        <data format="mslookupsql" name="lookupoutput"/>
    </outputs>

    <help>
    </help>

</tool>
