<tool id="msspsmtable_percolator" name="Add percolator data to PSM table" version="1.1">
    <description>from mzIdentMLs</description>
    <requirements>
        <requirement type="package" version="2.5">msstitch</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:"/>
    </stdio>
    <command>
        <![CDATA[
        msspsmtable percolator -i '$psmtable' --mzid '$mzidentml' -o psms.txt
        #if $filterpsm 
            &&
            msspsmtable conffilt -i psms.txt -o filteredpsms.txt --confidence-better lower --confidence-lvl $filterpsm --confcolpattern 'PSM q-value'
            && mv filteredpsms.txt psms.txt
        #end if
        #if $filterpeptide
            &&
            msspsmtable conffilt -i psms.txt -o filteredpsms.txt --confidence-better lower --confidence-lvl $filterpeptide --confcolpattern 'peptide q-value'
            && mv filteredpsms.txt psms.txt
        #end if
        && mv psms.txt '$output'
        ]]>        
    </command>
    <inputs>
        <param name="psmtable" type="data" format="tabular" label="Search table from MSGF+"/>
        <param name="mzidentml" type="data" format="mzid" label="Percolated MSGF+ mzIdentML data" />
        <param name="filterpsm" type="float" value="" optional="true" label="Cutoff level for percolator PSM q-values?" />
        <param name="filterpeptide" type="float" value="" optional="true" label="Cutoff level for percolator peptide q-values?" />
    </inputs>
    
    <outputs>
        <data format="tabular" name="output" label="PSMs with percolator" />
    </outputs>
    <tests>
        <test>
            <param name="psmtable" value="psmtable1.txt" />
            <param name="mzidentml" value="mzid_perco1.xml" />
            <param name="filterpsm" value="0.5" />
            <param name="filterpeptide" value="0.8" />
            <output name="output" value="minimal_psmtable_perco.txt" />
        </test>
    </tests>
    <help>
        This tool adds percolator data, currently from mzIdentMLs to the PSM table
    </help>
</tool>
