<tool id="sel_ann_hpa" name="Expression levels by tissue (from HPA)" version="0.1.0">
    <description>selects and/or annotates a list of ENSG IDs with tissue expression (HPA)
    </description>
    <requirements>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command interpreter="Rscript">
        $__tool_directory__/sel_ann_hpa.R
        --ref_file=$options.proteinatlas ##"$__tool_directory__/../../usecase1/normal_tissue.csv"
        --input_type="$input.ids"
        #if $input.ids == "list"
            --input="$input.list"
        #else
            --input="$input.file"
            --column_number="$input.ncol"
            --header="$input.header"
        #end if

        #if $options.database == "normal"
            --atlas="normal"
            --tissue="$options.tissue.tissue"
            --level="$options.level"
            --reliability="$options.reliability"
        #else if $options.database == "tumor"
            --atlas="cancer"
            --cancer="$options.cancer.cancer"
        #end if
        --not_mapped="$not_mapped"
        --output="$hpa_output"
    </command>
       <inputs>
           <conditional name="input" >
            <param name="ids" type="select" label="Provide your identifiers" help="Copy/paste or ID list from a file (e.g. table)" >
                <option value="list">Copy/paste your identifiers</option>
                <option value="file">Input file containing your identifiers</option>
            </param>
            <when value="list" >
                <param name="list" type="text" label="Copy/paste your identifiers" help='IDs must be separated by spaces into the form field, for example: P31946 P62258' >
                    <sanitizer>
                        <valid initial="string.printable">
                            <remove value="&apos;"/>
                        </valid>
                        <mapping initial="none">
                            <add source="&apos;" target="__sq__"/>
                        </mapping>
                    </sanitizer>
                </param>
            </when>
            <when value="file" >
                <param name="file" type="data" format="txt,tabular" label="Choose a file that contains your list of IDs" help="" />
                <param name="header" type="boolean" checked="true" truevalue="true" falsevalue="false" label="Does your input file contain header?" />
                <param name="ncol" type="text" label="The column number of IDs to map" help='For example, fill in "c1" if it is the first column, "c2" if it is the second column and so on' />                
            </when>
        </conditional>
        <conditional name="options">
            <param name="database" type="select" label="Human Protein Atlas">
                <option value="normal">Human Normal Tissue</option>
                <option value="tumor">Human Tumor Tissue</option>
            </param>
            <when value="normal">
                <param name="proteinatlas" type="select" label="Human Protein Atlas" >
                    <options from_file="proteinatlas.loc" >
		                <column name="name" index="1" />
		                <column name="value" index="2" />
		                <filter type="remove_value" meta_ref="proteinatlas" key="name" value="Full Human Protein Atlas" />
                        <filter type="remove_value" meta_ref="proteinatlas" key="name" value="HPA Tumor Tissue" />
	                </options>
	            </param>
                <section name="tissue" title="Keep and annotate genes present in the following tissue(s)" expanded="True">
                    <param name="tissue" type="select" label="Keep and annotate genes present in the following tissue(s)" multiple="True" display="checkboxes" optional="False">
                        <option value="adrenal gland" >Adrenal gland</option>
                        <option value="appendix" >Appendix</option>
                        <option value="bone marrow" >Bone marrow</option>
                        <option value="breast" >Breast</option>
                        <option value="bronchus" >Bronchus</option>
                        <option value="caudate" >Caudate</option>
                        <option value="cerebellum" >Cerebellum</option>
                        <option value="cerebral cortex" >Cerebral cortex</option>
                        <option value="cervix" >Cervix</option>
                        <option value="colon" >Colon</option>
                        <option value="duodenum" >Duodenum</option>
                        <option value="endometrium 1" >Endometrium 1</option>
                        <option value="endometrium 2" >Endometrium 2</option>
                        <option value="epididymis" >Epididymis</option>
                        <option value="esophagus" >Esophagus</option>
                        <option value="fallopian tube" >Fallopian tube</option>
                        <option value="gallbladder" >Gallbladder</option>
                        <option value="heart muscle" >Heart muscle</option>
                        <option value="hippocampus" >Hippocampus</option>
                        <option value="kidney" >Kidney</option>
                        <option value="liver" >Liver</option>
                        <option value="lung" >Lung</option>
                        <option value="lymph node" >Lymph node</option>
                        <option value="nasopharynx" >Nasopharynx</option>
                        <option value="oral mucosa" >Oral mucosa</option>
                        <option value="ovary" >Ovary</option>
                        <option value="pancreas" >Pancreas</option>
                        <option value="parathyroid gland" >Parathyroid gland</option>
                        <option value="placenta" >Placenta</option>
                        <option value="prostate" >Prostate</option>
                        <option value="rectum" >Rectum</option>
                        <option value="salivary gland" >Salivary gland</option>
                        <option value="seminal vesicle" >Seminal vesicle</option>
                        <option value="skeletal muscle" >Skeletal muscle</option>
                        <option value="skin 1" >Skin 1</option>
                        <option value="skin 2" >Skin 2</option>
                        <option value="small intestine" >Small intestine</option>
                        <option value="smooth muscle" >Smooth muscle</option>
                        <option value="soft tissue 1" >Soft tissue 1</option>
                        <option value="soft tissue 2" >Soft tissue 2</option>
                        <option value="spleen" >Spleen</option>
                        <option value="stomach 1" >Stomach 1</option>
                        <option value="stomach 2" >Stomach 2</option>
                        <option value="testis" >Testis</option>
                        <option value="thyroid gland" >Thyroid gland</option>
                        <option value="tonsil" >Tonsil</option>
                        <option value="urinary bladder" >Urinary bladder</option>
                        <option value="vagina" >Vagina</option>
                    </param>
                </section>
                <param name="level" type="select" label="Expression value" display="checkboxes" multiple="True" optional="False">
                    <option value="High" selected="true">High</option>
                    <option value="Medium" selected="true">Medium</option>
                    <option value="Low" selected="true">Low</option>
                    <option value="Not detected" selected="true">Not detected</option>
                </param>
                <param name="reliability" type="select" label="The gene reliability of the expression value" display="checkboxes" multiple="True" optional="False">
                    <option value="Approved" selected="true">Approved</option>
                    <option value="Supported" selected="true">Supported</option>
                    <option value="Uncertain" selected="true">Uncertain</option>
                </param>
            </when>
            <when value="tumor">
                <param name="proteinatlas" type="select" label="Human Protein Atlas" >
                    <options from_file="proteinatlas.loc" >
		                <column name="name" index="1" />
		                <column name="value" index="2" />
		                <filter type="remove_value" meta_ref="proteinatlas" key="name" value="Full Human Protein Atlas" />
                        <filter type="remove_value" meta_ref="proteinatlas" key="name" value="HPA Normal Tissue" />
	                </options>
	            </param>
                <section name="cancer" title="" expanded="True">
                    <param name="cancer" type="select" label="" multiple="True" display="checkboxes" optional="False">
                        <option value="breast cancer" >Breast cancer</option>
                        <option value="carcinoid" >Carcinoid</option>
                        <option value="cervical cancer" >Cervical cancer</option>
                        <option value="colorectal cancer" >Colorectal cancer</option>
                        <option value="endometrial cancer" >Endometrial cancer</option>
                        <option value="glioma" >Glioma</option>
                        <option value="head and neck cancer" >Head and neck cancer</option>
                        <option value="liver cancer" >Liver cancer</option>
                        <option value="lung cancer" >Lung cancer</option>
                        <option value="lymphoma" >Lymphoma</option>
                        <option value="melanoma" >Melanoma</option>
                        <option value="ovarian cancer" >Ovarian cancer</option>
                        <option value="pancreatic cancer" >Pancreatic cancer</option>
                        <option value="prostate cancer" >Prostate cancer</option>
                        <option value="renal cancer" >Renal cancer</option>
                        <option value="skin cancer" >Skin cancer</option>
                        <option value="stomach cancer" >Stomach cancer</option>
                        <option value="testis cancer" >Testis cancer</option>
                        <option value="thyroid cancer" >Thyroid cancer</option>
                        <option value="urothelial cancer" >Urothelial cancer</option>
                    </param>
                </section>
            </when>
        </conditional>
        <param name="not_mapped" type="boolean" truevalue="true" falsevalue="false" label="Would you like to include in output the IDs that does not match criteria and are not mapped in HPA?" checked="true"/>
    </inputs>
    <outputs>
        <data name="hpa_output" format="txt" label="" />
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="ids" value="file"/>
                <param name="file" value="ENSGid.txt"/>
                <param name="header" value="true"/>
                <param name="ncol" value="c1"/>
            </conditional>
            <section name="tissue">
                <param name="tissue" value="lung"/>
            </section>
            <param name="level" value="Not detected,Medium,High,Low"/>
            <param name="reliability" value="Approved,Supported,Uncertain"/>
            <param name="not_mapped" value="true" />
            <output name="hpa_output" file="ENSG_tissue_output.txt"/>
        </test>
    </tests>
    <help><![CDATA[
        This tool selects and/or annotate a list of ENSG IDs with tissue expression (HPA)
        
    ]]></help>
    <citations>
    </citations>
</tool>
